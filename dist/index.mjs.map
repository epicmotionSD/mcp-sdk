{"version":3,"sources":["../src/config/index.ts","../src/demo/index.ts","../src/errors/codes.ts","../src/errors/index.ts","../src/validate/index.ts","../src/logger/index.ts","../src/telemetry/index.ts","../src/server/index.ts","../src/payment/index.ts"],"names":["DEMO_PREFIX"],"mappings":";;;;AAmCA,IAAI,YAAA,GAA+B;AAAA,EACjC,MAAA,EAAQ,IAAA;AAAA,EACR,QAAA,EAAU,KAAA;AAAA,EACV,UAAA,EAAY,YAAA;AAAA,EACZ,aAAA,EAAe,OAAA;AAAA,EACf,WAAA,EAAa;AACf,CAAA;AAMA,IAAM,WAAA,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA;AAkBpB,IAAM,iBAAA,GAAoB;AAAA;AAAA;AAAA;AAAA,CAAA;AAoCnB,SAAS,iBAAA,CAAkB,MAAA,GAA8B,EAAC,EAAmB;AAElF,EAAA,MAAM,MAAA,GAAS,MAAA,CAAO,MAAA,IAAU,OAAA,CAAQ,IAAI,qBAAA,IAAyB,IAAA;AAIrE,EAAA,MAAM,QAAA,GAAW,MAAA,CAAO,QAAA,KAAa,IAAA,IAAQ,CAAC,MAAA;AAE9C,EAAA,YAAA,GAAe;AAAA,IACb,MAAA,EAAQ,WAAW,IAAA,GAAO,MAAA;AAAA,IAC1B,QAAA;AAAA,IACA,UAAA,EAAY,MAAA,CAAO,UAAA,IAAc,OAAA,CAAQ,IAAI,yBAAA,IAA6B,YAAA;AAAA,IAC1E,aAAA,EAAe,MAAA,CAAO,aAAA,IAAiB,OAAA,CAAQ,IAAI,mBAAA,IAAuB,OAAA;AAAA,IAC1E,WAAA,EAAa;AAAA,GACf;AAGA,EAAA,IAAI,CAAC,OAAO,KAAA,EAAO;AACjB,IAAA,IAAI,QAAA,EAAU;AACZ,MAAA,OAAA,CAAQ,IAAI,WAAW,CAAA;AAAA,IACzB,CAAA,MAAO;AACL,MAAA,OAAA,CAAQ,IAAI,iBAAiB,CAAA;AAAA,IAC/B;AAAA,EACF;AAEA,EAAA,OAAO,YAAA;AACT;AAMO,SAAS,SAAA,GAA4B;AAC1C,EAAA,IAAI,CAAC,aAAa,WAAA,EAAa;AAE7B,IAAA,OAAO,iBAAA,CAAkB,EAAE,KAAA,EAAO,IAAA,EAAM,CAAA;AAAA,EAC1C;AACA,EAAA,OAAO,YAAA;AACT;AAKO,SAAS,UAAA,GAAsB;AACpC,EAAA,OAAO,WAAU,CAAE,QAAA;AACrB;AAKO,SAAS,aAAA,GAAyB;AACvC,EAAA,OAAO,YAAA,CAAa,WAAA;AACtB;AAKO,SAAS,WAAA,GAAoB;AAClC,EAAA,YAAA,GAAe;AAAA,IACb,MAAA,EAAQ,IAAA;AAAA,IACR,QAAA,EAAU,KAAA;AAAA,IACV,UAAA,EAAY,YAAA;AAAA,IACZ,aAAA,EAAe,OAAA;AAAA,IACf,WAAA,EAAa;AAAA,GACf;AACF;;;ACzJO,IAAM,mBAAA,GAAqC;AAAA,EAChD,OAAA,EAAS,IAAA;AAAA,EACT,OAAA,EAAS,IAAA;AAAA,EACT,IAAA,EAAM,MAAA;AAAA,EACN,MAAA,EAAQ,MAAA;AAAA,EACR,SAAA,EAAW;AACb;AAEO,IAAM,iBAAA,GAAoB;AAAA,EAC/B,OAAA,EAAS,IAAA;AAAA,EACT,IAAA,EAAM,MAAA;AAAA,EACN,MAAA,EAAQ;AACV;AAEO,IAAM,iBAAA,GAAwD;AAAA,EACnE,OAAA,EAAS;AAAA,IACP,IAAA,EAAM,cAAA;AAAA,IACN,OAAA,EAAS,GAAA;AAAA,IACT,KAAA,EAAO,IAAA;AAAA,IACP,SAAA,EAAW,MAAA;AAAA,IACX,OAAA,EAAS,CAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA,GAAA,EAAK;AAAA,IACH,IAAA,EAAM,UAAA;AAAA,IACN,OAAA,EAAS,GAAA;AAAA,IACT,KAAA,EAAO,KAAA;AAAA,IACP,SAAA,EAAW,MAAA;AAAA,IACX,OAAA,EAAS,EAAA;AAAA,IACT,OAAA,EAAS,kBAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,eAAA;AAAA,IACN,OAAA,EAAS,GAAA;AAAA,IACT,KAAA,EAAO,MAAA;AAAA,IACP,SAAA,EAAW,MAAA;AAAA,IACX,OAAA,EAAS,EAAA;AAAA,IACT,OAAA,EAAS;AAAA;AAEb;AAMA,SAAS,qBAAqB,IAAA,EAAwE;AACpG,EAAA,MAAM,WAAqE,EAAC;AAC5E,EAAA,MAAM,GAAA,uBAAU,IAAA,EAAK;AAErB,EAAA,KAAA,IAAS,CAAA,GAAI,IAAA,GAAO,CAAA,EAAG,CAAA,IAAK,GAAG,CAAA,EAAA,EAAK;AAClC,IAAA,MAAM,IAAA,GAAO,IAAI,IAAA,CAAK,GAAG,CAAA;AACzB,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,OAAA,EAAQ,GAAI,CAAC,CAAA;AAC/B,IAAA,QAAA,CAAS,IAAA,CAAK;AAAA,MACZ,MAAM,IAAA,CAAK,WAAA,GAAc,KAAA,CAAM,GAAG,EAAE,CAAC,CAAA;AAAA,MACrC,MAAM,IAAA,CAAK,KAAA,CAAM,KAAK,MAAA,EAAO,GAAI,EAAE,CAAA,GAAI,EAAA;AAAA,MACvC,SAAA,EAAW,CAAA,GAAI,CAAA,KAAM,CAAA,GAAI,GAAA,GAAM;AAAA;AAAA,KAChC,CAAA;AAAA,EACH;AAEA,EAAA,OAAO,QAAA;AACT;AAEA,SAAS,yBAAyB,KAAA,EAAqD;AACrF,EAAA,MAAM,QAAQ,CAAC,cAAA,EAAgB,iBAAA,EAAmB,aAAA,EAAe,aAAa,WAAW,CAAA;AACzF,EAAA,MAAM,eAAqD,EAAC;AAC5D,EAAA,MAAM,GAAA,uBAAU,IAAA,EAAK;AAErB,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,EAAO,CAAA,EAAA,EAAK;AAC9B,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,MAAA,EAAO,GAAI,GAAA;AAChC,IAAA,MAAM,IAAA,GAAO,IAAI,IAAA,CAAK,GAAG,CAAA;AACzB,IAAA,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,QAAA,EAAS,GAAI,IAAI,CAAC,CAAA;AAErC,IAAA,YAAA,CAAa,IAAA,CAAK;AAAA,MAChB,EAAA,EAAI,YAAY,CAAC,CAAA,CAAA;AAAA,MACjB,MAAA,EAAQ,OAAA,GAAU,EAAE,IAAA,CAAK,KAAA,CAAM,KAAK,MAAA,EAAO,GAAI,EAAE,CAAA,GAAI,CAAA,CAAA,GAAK,GAAA;AAAA,MAC1D,IAAA,EAAM,UAAU,OAAA,GAAU,UAAA;AAAA,MAC1B,IAAA,EAAM,OAAA,GAAU,KAAA,CAAM,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,MAAA,EAAO,GAAI,KAAA,CAAM,MAAM,CAAC,CAAA,GAAI,IAAA;AAAA,MAClE,SAAA,EAAW,KAAK,WAAA;AAAY,KAC7B,CAAA;AAAA,EACH;AAEA,EAAA,OAAO,YAAA;AACT;AAEO,SAAS,iBAAiB,MAAA,EAAsD;AACrF,EAAA,MAAM,IAAA,GAAO,WAAW,KAAA,GAAQ,CAAA,GAAI,WAAW,IAAA,GAAO,CAAA,GAAI,MAAA,KAAW,KAAA,GAAQ,EAAA,GAAK,EAAA;AAClF,EAAA,MAAM,QAAA,GAAW,qBAAqB,IAAI,CAAA;AAC1C,EAAA,MAAM,SAAA,GAAY,SAAS,MAAA,CAAO,CAAC,KAAK,CAAA,KAAM,GAAA,GAAM,CAAA,CAAE,IAAA,EAAM,CAAC,CAAA;AAC7D,EAAA,MAAM,cAAA,GAAiB,SAAS,MAAA,CAAO,CAAC,KAAK,CAAA,KAAM,GAAA,GAAM,CAAA,CAAE,SAAA,EAAW,CAAC,CAAA;AAEvE,EAAA,OAAO;AAAA,IACL,MAAA;AAAA,IACA,OAAA,EAAS,IAAA;AAAA,IACT,OAAA,EAAS;AAAA,MACP,SAAA;AAAA,MACA,cAAA;AAAA,MACA,WAAW,cAAA,GAAiB,SAAA;AAAA,MAC5B,UAAU,SAAA,GAAY,IAAA;AAAA,MACtB,aAAA,EAAe,IAAA,CAAK,KAAA,CAAM,IAAA,IAAQ,YAAY,IAAA,CAAK,CAAA;AAAA,MACnD,SAAA,EAAW,CAAA;AAAA,MACX,kBAAkB,IAAA,GAAO;AAAA,KAC3B;AAAA,IACA,QAAA,EAAU;AAAA,MACR,EAAE,IAAA,EAAM,cAAA,EAAgB,KAAA,EAAO,GAAA,EAAK,SAAS,GAAA,EAAI;AAAA,MACjD,EAAE,IAAA,EAAM,iBAAA,EAAmB,KAAA,EAAO,EAAA,EAAI,SAAS,GAAA,EAAI;AAAA,MACnD,EAAE,IAAA,EAAM,aAAA,EAAe,KAAA,EAAO,GAAA,EAAK,SAAS,GAAA,EAAI;AAAA,MAChD,EAAE,IAAA,EAAM,WAAA,EAAa,KAAA,EAAO,EAAA,EAAI,SAAS,GAAA,EAAI;AAAA,MAC7C,EAAE,IAAA,EAAM,WAAA,EAAa,KAAA,EAAO,EAAA,EAAI,SAAS,EAAA;AAAG,KAC9C;AAAA,IACA,aAAA,EAAe,QAAA;AAAA,IACf,kBAAA,EAAoB,yBAAyB,EAAE;AAAA,GACjD;AACF;AAoBA,IAAM,WAAA,GAAc,kBAAA;AAEb,IAAM,UAAA,GAAa;AAAA,EACxB,SAAA,EAAW,CAAC,MAAA,EAAgB,IAAA,KAAkC;AAC5D,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,WAAW,CAAA,WAAA,EAAc,MAAM,CAAA,CAAA,CAAA,EAAK,IAAA,CAAK,SAAA,CAAU,IAAA,EAAM,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAClF,CAAA;AAAA,EAEA,OAAA,EAAS,CAAC,MAAA,EAAgB,IAAA,KAAkC;AAC1D,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,WAAW,CAAA,SAAA,EAAY,MAAM,CAAA,CAAA,CAAA,EAAK,IAAA,CAAK,SAAA,CAAU,IAAA,EAAM,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,EAChF,CAAA;AAAA,EAEA,OAAA,EAAS,CAAC,MAAA,EAAgB,MAAA,KAA0B;AAClD,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,WAAW,CAAA,mBAAA,EAAsB,MAAM,CAAA,qBAAA,CAAuB,CAAA;AAAA,EAC/E,CAAA;AAAA,EAEA,MAAA,EAAQ,CAAC,MAAA,EAAgB,OAAA,EAAiB,IAAA,KAAiB;AACzD,IAAA,OAAA,CAAQ,GAAA,CAAI,GAAG,WAAW,CAAA,cAAA,EAAiB,OAAO,CAAA,cAAA,EAAiB,MAAM,CAAA,KAAA,EAAQ,IAAI,CAAA,kBAAA,CAAoB,CAAA;AAAA,EAC3G;AACF;;;AChKO,IAAM,UAAA,GAAa;AAAA;AAAA,EAExB,WAAA,EAAa,MAAA;AAAA,EACb,eAAA,EAAiB,MAAA;AAAA,EACjB,gBAAA,EAAkB,MAAA;AAAA,EAClB,cAAA,EAAgB,MAAA;AAAA,EAChB,cAAA,EAAgB,MAAA;AAAA;AAAA,EAGhB,cAAA,EAAgB,MAAA;AAAA,EAChB,oBAAA,EAAsB,MAAA;AAAA,EACtB,kBAAA,EAAoB,MAAA;AAAA,EACpB,oBAAA,EAAsB,MAAA;AAAA,EACtB,mBAAA,EAAqB,MAAA;AAAA,EACrB,gBAAA,EAAkB,MAAA;AAAA,EAClB,aAAA,EAAe,MAAA;AAAA,EACf,gBAAA,EAAkB,MAAA;AAAA,EAClB,gBAAA,EAAkB,MAAA;AAAA,EAClB,mBAAA,EAAqB,MAAA;AAAA,EACrB,gBAAA,EAAkB,MAAA;AAAA,EAClB,oBAAA,EAAsB,MAAA;AAAA,EACtB,qBAAA,EAAuB;AACzB;;;AClBO,IAAM,QAAA,GAAN,cAAuB,KAAA,CAAM;AAAA,EAClB,IAAA;AAAA,EACA,IAAA;AAAA,EAEhB,WAAA,CACE,IAAA,EACA,OAAA,EACA,IAAA,EACA;AACA,IAAA,KAAA,CAAM,OAAO,CAAA;AACb,IAAA,IAAA,CAAK,IAAA,GAAO,UAAA;AACZ,IAAA,IAAA,CAAK,IAAA,GAAO,IAAA;AACZ,IAAA,IAAA,CAAK,IAAA,GAAO,IAAA;AAGZ,IAAA,IAAI,MAAM,iBAAA,EAAmB;AAC3B,MAAA,KAAA,CAAM,iBAAA,CAAkB,IAAA,EAAM,IAAA,CAAK,WAAW,CAAA;AAAA,IAChD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAA,GAAS;AACP,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,GAAI,IAAA,CAAK,IAAA,IAAQ,EAAE,IAAA,EAAM,KAAK,IAAA;AAAK,KACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,CAAW,KAA6B,IAAA,EAAM;AAC5C,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,EAAA;AAAA,MACA,KAAA,EAAO,KAAK,MAAA;AAAO,KACrB;AAAA,EACF;AACF;AAKO,IAAM,eAAA,GAAN,cAA8B,QAAA,CAAS;AAAA,EAC5C,WAAA,CAAY,KAAA,EAAe,MAAA,EAAgB,KAAA,EAAiB;AAC1D,IAAA,KAAA,CAAM,WAAW,cAAA,EAAgB,CAAA,uBAAA,EAA0B,KAAK,CAAA,GAAA,EAAM,MAAM,CAAA,CAAA,EAAI;AAAA,MAC9E,KAAA;AAAA,MACA,MAAA;AAAA,MACA,GAAI,KAAA,KAAU,MAAA,IAAa,EAAE,KAAA;AAAM,KACpC,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,iBAAA;AAAA,EACd;AACF;AAKO,IAAM,iBAAA,GAAN,cAAgC,QAAA,CAAS;AAAA,EAC9C,YAAY,QAAA,EAAkB;AAC5B,IAAA,KAAA,CAAM,UAAA,CAAW,cAAA,EAAgB,CAAA,MAAA,EAAS,QAAQ,CAAA,WAAA,CAAA,EAAe;AAAA,MAC/D,IAAA,EAAM;AAAA,KACP,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,mBAAA;AAAA,EACd;AACF;AAKO,IAAM,kBAAA,GAAN,cAAiC,QAAA,CAAS;AAAA,EAC/C,WAAA,CAAY,QAAA,EAAkB,MAAA,EAAgB,KAAA,EAAe;AAC3D,IAAA,KAAA,CAAM,WAAW,oBAAA,EAAsB,CAAA,MAAA,EAAS,QAAQ,CAAA,UAAA,EAAa,MAAM,CAAA,CAAA,EAAI;AAAA,MAC7E,IAAA,EAAM,QAAA;AAAA,MACN,MAAA;AAAA,MACA,GAAI,KAAA,IAAS,EAAE,KAAA,EAAO,MAAM,OAAA;AAAQ,KACrC,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AAAA,EACd;AACF;AAKO,IAAM,qBAAA,GAAN,cAAoC,QAAA,CAAS;AAAA,EAClD,YAAY,WAAA,EAAqB;AAC/B,IAAA,KAAA,CAAM,UAAA,CAAW,kBAAA,EAAoB,CAAA,UAAA,EAAa,WAAW,CAAA,WAAA,CAAA,EAAe;AAAA,MAC1E,GAAA,EAAK;AAAA,KACN,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,uBAAA;AAAA,EACd;AACF;AAKO,IAAM,mBAAA,GAAN,cAAkC,QAAA,CAAS;AAAA,EAChD,WAAA,CAAY,SAAiB,yBAAA,EAA2B;AACtD,IAAA,KAAA,CAAM,UAAA,CAAW,sBAAsB,MAAM,CAAA;AAC7C,IAAA,IAAA,CAAK,IAAA,GAAO,qBAAA;AAAA,EACd;AACF;AAKO,IAAM,kBAAA,GAAN,cAAiC,QAAA,CAAS;AAAA,EAC/C,WAAA,CAAY,QAAgB,QAAA,EAAmB;AAC7C,IAAA,MAAM,GAAA,GAAM,WACR,CAAA,kBAAA,EAAqB,MAAM,QAAQ,QAAQ,CAAA,CAAA,CAAA,GAC3C,qBAAqB,MAAM,CAAA,CAAA;AAC/B,IAAA,KAAA,CAAM,UAAA,CAAW,qBAAqB,GAAA,EAAK;AAAA,MACzC,MAAA;AAAA,MACA,GAAI,QAAA,IAAY,EAAE,QAAA;AAAS,KAC5B,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AAAA,EACd;AACF;AAKO,IAAM,cAAA,GAAN,cAA6B,QAAA,CAAS;AAAA,EAC3C,YAAY,YAAA,EAAuB;AACjC,IAAA,KAAA,CAAM,UAAA,CAAW,kBAAkB,qBAAA,EAAuB;AAAA,MACxD,GAAI,YAAA,IAAgB,EAAE,YAAA;AAAa,KACpC,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,gBAAA;AAAA,EACd;AACF;AAKO,IAAM,YAAA,GAAN,cAA2B,QAAA,CAAS;AAAA,EACzC,WAAA,CAAY,WAAmB,SAAA,EAAmB;AAChD,IAAA,KAAA,CAAM,WAAW,aAAA,EAAe,CAAA,WAAA,EAAc,SAAS,CAAA,kBAAA,EAAqB,SAAS,CAAA,EAAA,CAAA,EAAM;AAAA,MACzF,SAAA;AAAA,MACA;AAAA,KACD,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,cAAA;AAAA,EACd;AACF;AAKO,IAAM,eAAA,GAAN,cAA8B,QAAA,CAAS;AAAA,EAC5C,WAAA,CAAY,YAAoB,MAAA,EAAgB;AAC9C,IAAA,KAAA,CAAM,WAAW,gBAAA,EAAkB,CAAA,YAAA,EAAe,UAAU,CAAA,eAAA,EAAkB,MAAM,CAAA,CAAA,EAAI;AAAA,MACtF,UAAA;AAAA,MACA;AAAA,KACD,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,iBAAA;AAAA,EACd;AACF;AAKO,IAAM,kBAAA,GAAN,cAAiC,QAAA,CAAS;AAAA,EAC/C,WAAA,CAAY,SAAiB,MAAA,EAAgB;AAC3C,IAAA,KAAA,CAAM,WAAW,mBAAA,EAAqB,CAAA,uBAAA,EAA0B,OAAO,CAAA,GAAA,EAAM,MAAM,CAAA,CAAA,EAAI;AAAA,MACrF,OAAA;AAAA,MACA;AAAA,KACD,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AAAA,EACd;AACF;AAKO,IAAM,oBAAA,GAAN,cAAmC,QAAA,CAAS;AAAA,EACjD,WAAA,CAAY,UAAkB,OAAA,EAAqD;AACjF,IAAA,KAAA,CAAM,UAAA,CAAW,gBAAA,EAAkB,CAAA,yBAAA,EAA4B,QAAQ,CAAA,CAAA,CAAA,EAAK;AAAA,MAC1E,IAAA,EAAM,QAAA;AAAA,MACN,GAAI,OAAA,EAAS,UAAA,IAAc,EAAE,UAAA,EAAY,QAAQ,UAAA,EAAW;AAAA,MAC5D,GAAI,OAAA,EAAS,OAAA,IAAW,EAAE,OAAA,EAAS,QAAQ,OAAA;AAAQ,KACpD,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,sBAAA;AAAA,EACd;AACF;AAKO,IAAM,wBAAA,GAAN,cAAuC,QAAA,CAAS;AAAA,EACrD,WAAA,CAAY,QAAA,EAAkB,SAAA,EAAmB,OAAA,EAAoC;AACnF,IAAA,KAAA,CAAM,WAAW,oBAAA,EAAsB,CAAA,2BAAA,EAA8B,QAAQ,CAAA,OAAA,EAAU,SAAS,CAAA,CAAA,EAAI;AAAA,MAClG,QAAA;AAAA,MACA,SAAA;AAAA,MACA,GAAI,OAAA,EAAS,WAAA,IAAe,EAAE,WAAA,EAAa,QAAQ,WAAA;AAAY,KAChE,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,0BAAA;AAAA,EACd;AACF;AAKO,IAAM,yBAAA,GAAN,cAAwC,QAAA,CAAS;AAAA,EACtD,WAAA,CAAY,YAAA,EAAsB,WAAA,EAAsB,OAAA,EAAmC;AACzF,IAAA,MAAM,GAAA,GAAM,cACR,CAAA,cAAA,EAAiB,YAAY,yBAAyB,WAAW,CAAA,EAAA,CAAA,GACjE,iBAAiB,YAAY,CAAA,UAAA,CAAA;AACjC,IAAA,KAAA,CAAM,UAAA,CAAW,uBAAuB,GAAA,EAAK;AAAA,MAC3C,YAAA;AAAA,MACA,GAAI,WAAA,IAAe,EAAE,WAAA,EAAY;AAAA,MACjC,GAAI,OAAA,EAAS,UAAA,IAAc,EAAE,UAAA,EAAY,QAAQ,UAAA;AAAW,KAC7D,CAAA;AACD,IAAA,IAAA,CAAK,IAAA,GAAO,2BAAA;AAAA,EACd;AACF;AC1MO,SAAS,QAAA,CACd,MAAA,EACA,KAAA,EACA,OAAA,GAA2B,EAAC,EACzB;AACH,EAAA,MAAM,EAAE,YAAA,GAAe,IAAA,EAAK,GAAI,OAAA;AAEhC,EAAA,MAAM,SACJ,YAAA,GACI,MAAA,CAAO,SAAA,CAAU,KAAK,IACtB,MAAA,YAAkB,CAAA,CAAE,SAAA,GAClB,MAAA,CAAO,QAAO,CAAE,SAAA,CAAU,KAAK,CAAA,GAC/B,MAAA,CAAO,UAAU,KAAK,CAAA;AAG9B,EAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,IAAA,MAAM,UAAA,GAAa,MAAA,CAAO,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA;AACxC,IAAA,MAAM,KAAA,GAAQ,UAAA,CAAW,IAAA,CAAK,IAAA,CAAK,GAAG,CAAA,IAAK,OAAA;AAC3C,IAAA,MAAM,SAAS,UAAA,CAAW,OAAA;AAC1B,IAAA,MAAM,IAAI,eAAA;AAAA,MAAgB,KAAA;AAAA,MAAO,MAAA;AAAA,MAAQ,UAAA,CAAW,KAAK,MAAA,GAAS,CAAA,GAC9D,eAAe,KAAA,EAAO,UAAA,CAAW,IAAI,CAAA,GACrC;AAAA,KACJ;AAAA,EACF;AAEA,EAAA,OAAO,MAAA,CAAO,IAAA;AAChB;AAMO,SAAS,aAAA,CACd,MAAA,EACA,OAAA,EACA,OAAA,GAA2B,EAAC,EACU;AACtC,EAAA,OAAO,OAAO,KAAA,KAAmB;AAC/B,IAAA,MAAM,SAAA,GAAY,QAAA,CAAS,MAAA,EAAQ,KAAA,EAAO,OAAO,CAAA;AACjD,IAAA,OAAO,QAAQ,SAAS,CAAA;AAAA,EAC1B,CAAA;AACF;AAMA,SAAS,cAAA,CAAe,KAAc,IAAA,EAAoC;AACxE,EAAA,IAAI,OAAA,GAAU,GAAA;AACd,EAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,IAAA,IAAI,OAAA,KAAY,IAAA,IAAQ,OAAA,KAAY,MAAA,EAAW,OAAO,MAAA;AACtD,IAAA,OAAA,GAAW,QAA6C,GAAG,CAAA;AAAA,EAC7D;AACA,EAAA,OAAO,OAAA;AACT;AAKO,IAAM,OAAA,GAAU;AAAA;AAAA,EAErB,gBAAgB,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,CAAI,GAAG,iBAAiB,CAAA;AAAA;AAAA,EAGnD,aAAa,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,GAAM,QAAA,EAAS;AAAA;AAAA,EAGvC,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,EAAI,CAAE,GAAA,CAAI,CAAC,CAAA,CAAE,GAAA,CAAI,GAAG,CAAA,CAAE,QAAQ,EAAE,CAAA;AAAA;AAAA,EAGlD,MAAA,EAAQ,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,GAAM,GAAA,CAAI,CAAC,CAAA,CAAE,OAAA,CAAQ,CAAC,CAAA;AAAA;AAAA,EAGzC,GAAA,EAAK,CAAA,CAAE,MAAA,EAAO,CAAE,GAAA,EAAI;AAAA;AAAA,EAGpB,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,KAAA,EAAM;AAAA;AAAA,EAGxB,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,IAAA,EAAK;AAAA;AAAA,EAGtB,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,EAAS;AAAA;AAAA,EAG7B,UAAA,EAAY,EAAE,KAAA,CAAM;AAAA,IAClB,EAAE,OAAA,EAAQ;AAAA,IACV,CAAA,CAAE,IAAA,CAAK,CAAC,MAAA,EAAQ,OAAO,CAAC,CAAA,CAAE,SAAA,CAAU,CAAA,CAAA,KAAK,CAAA,KAAM,MAAM;AAAA,GACtD;AACH;;;ACzFA,IAAM,cAAA,GAA2C;AAAA,EAC/C,KAAA,EAAO,CAAA;AAAA,EACP,IAAA,EAAM,CAAA;AAAA,EACN,IAAA,EAAM,CAAA;AAAA,EACN,KAAA,EAAO;AACT,CAAA;AAKO,SAAS,YAAA,CAAa,OAAA,EAAiB,OAAA,GAAyB,EAAC,EAAG;AACzE,EAAA,MAAM;AAAA,IACJ,OAAO,QAAA,GAAW,MAAA;AAAA,IAClB,UAAA,GAAa,IAAA;AAAA,IACb,MAAA,GAAS;AAAA,GACX,GAAI,OAAA;AAEJ,EAAA,MAAM,SAAA,GAAY,CAAC,KAAA,KAA6B;AAC9C,IAAA,OAAO,cAAA,CAAe,KAAK,CAAA,IAAK,cAAA,CAAe,QAAQ,CAAA;AAAA,EACzD,CAAA;AAEA,EAAA,MAAM,WAAA,GAAc,CAAC,KAAA,KAA4B;AAC/C,IAAA,OAAO,MAAA,GAAS,KAAK,SAAA,CAAU,KAAA,EAAO,MAAM,CAAC,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,KAAK,CAAA;AAAA,EACvE,CAAA;AAEA,EAAA,MAAM,GAAA,GAAM,CAAC,KAAA,EAAiB,OAAA,EAAiB,IAAA,KAAmC;AAChF,IAAA,IAAI,CAAC,SAAA,CAAU,KAAK,CAAA,EAAG;AAEvB,IAAA,MAAM,KAAA,GAAkB;AAAA,MACtB,GAAI,cAAc,EAAE,SAAA,EAAA,qBAAe,IAAA,EAAK,EAAE,aAAY,EAAE;AAAA,MACxD,KAAA;AAAA,MACA,OAAA;AAAA,MACA,OAAA;AAAA,MACA,GAAG;AAAA,KACL;AAEA,IAAA,IAAI,QAAQ,MAAA,EAAQ;AAClB,MAAA,OAAA,CAAQ,OAAO,KAAK,CAAA;AAAA,IACtB,CAAA,MAAO;AACL,MAAA,MAAM,SAAA,GAAY,YAAY,KAAK,CAAA;AACnC,MAAA,QAAQ,KAAA;AAAO,QACb,KAAK,OAAA;AACH,UAAA,OAAA,CAAQ,MAAM,SAAS,CAAA;AACvB,UAAA;AAAA,QACF,KAAK,MAAA;AACH,UAAA,OAAA,CAAQ,KAAK,SAAS,CAAA;AACtB,UAAA;AAAA,QACF,KAAK,MAAA;AACH,UAAA,OAAA,CAAQ,KAAK,SAAS,CAAA;AACtB,UAAA;AAAA,QACF,KAAK,OAAA;AACH,UAAA,OAAA,CAAQ,MAAM,SAAS,CAAA;AACvB,UAAA;AAAA;AACJ,IACF;AAEA,IAAA,OAAO,KAAA;AAAA,EACT,CAAA;AAEA,EAAA,OAAO;AAAA,IACL,OAAO,CAAC,OAAA,EAAiB,SAAmC,GAAA,CAAI,OAAA,EAAS,SAAS,IAAI,CAAA;AAAA,IACtF,MAAM,CAAC,OAAA,EAAiB,SAAmC,GAAA,CAAI,MAAA,EAAQ,SAAS,IAAI,CAAA;AAAA,IACpF,MAAM,CAAC,OAAA,EAAiB,SAAmC,GAAA,CAAI,MAAA,EAAQ,SAAS,IAAI,CAAA;AAAA,IACpF,OAAO,CAAC,OAAA,EAAiB,SAAmC,GAAA,CAAI,OAAA,EAAS,SAAS,IAAI,CAAA;AAAA;AAAA;AAAA;AAAA,IAKtF,KAAA,EAAO,CAAC,OAAA,KAAqC;AAC3C,MAAA,OAAO,aAAa,OAAA,EAAS;AAAA,QAC3B,GAAG,OAAA;AAAA,QACH,MAAA,EAAQ,CAAC,KAAA,KAAU;AACjB,UAAA,MAAM,MAAA,GAAS,EAAE,GAAG,KAAA,EAAO,GAAG,OAAA,EAAQ;AACtC,UAAA,IAAI,QAAQ,MAAA,EAAQ;AAClB,YAAA,OAAA,CAAQ,OAAO,MAAM,CAAA;AAAA,UACvB,CAAA,MAAO;AACL,YAAA,MAAM,SAAA,GAAY,MAAA,GAAS,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,MAAM,CAAC,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AAClF,YAAA,OAAA,CAAQ,KAAA,CAAM,KAAK,CAAA,CAAE,SAAS,CAAA;AAAA,UAChC;AAAA,QACF;AAAA,OACD,CAAA;AAAA,IACH;AAAA,GACF;AACF;;;ACjEA,IAAM,WAAA,GAAc,OAAA;AACpB,IAAM,gBAAA,GAAmB,qDAAA;AAEzB,IAAI,eAAA,GAAoD,IAAA;AAQjD,SAAS,cAAc,MAAA,EAAqD;AACjF,EAAA,MAAM,YAAY,SAAA,EAAU;AAG5B,EAAA,IAAI,YAAW,EAAG;AAChB,IAAA,eAAA,GAAkB,IAAI,aAAA;AAAA,MACpB,MAAA,EAAQ,cAAc,SAAA,CAAU,UAAA;AAAA,MAChC,MAAA,EAAQ,iBAAiB,SAAA,CAAU;AAAA,KACrC;AACA,IAAA,OAAO,eAAA;AAAA,EACT;AAGA,EAAA,IAAI,CAAC,QAAQ,MAAA,EAAQ;AACnB,IAAA,MAAM,IAAI,MAAM,4GAA4G,CAAA;AAAA,EAC9H;AAEA,EAAA,eAAA,GAAkB,IAAI,UAAU,MAAM,CAAA;AACtC,EAAA,OAAO,eAAA;AACT;AAKO,SAAS,YAAA,GAAiD;AAC/D,EAAA,OAAO,eAAA;AACT;AAGO,IAAM,YAAN,MAAgB;AAAA,EACb,MAAA;AAAA,EACE,SAAuB,EAAC;AAAA,EAC1B,UAAA,GAAoD,IAAA;AAAA,EAE5D,YAAY,MAAA,EAAyB;AACnC,IAAA,IAAA,CAAK,MAAA,GAAS;AAAA,MACZ,QAAQ,MAAA,CAAO,MAAA;AAAA,MACf,YAAY,MAAA,CAAO,UAAA;AAAA,MACnB,eAAe,MAAA,CAAO,aAAA;AAAA,MACtB,QAAA,EAAU,OAAO,QAAA,IAAY,gBAAA;AAAA,MAC7B,SAAA,EAAW,OAAO,SAAA,IAAa,EAAA;AAAA,MAC/B,aAAA,EAAe,OAAO,aAAA,IAAiB,GAAA;AAAA,MACvC,KAAA,EAAO,OAAO,KAAA,IAAS;AAAA,KACzB;AAGA,IAAA,IAAA,CAAK,UAAA,GAAa,YAAY,MAAM;AAClC,MAAA,IAAA,CAAK,OAAM,CAAE,KAAA,CAAM,KAAK,WAAA,CAAY,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,IAChD,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,aAAa,CAAA;AAG5B,IAAA,IAAI,OAAO,YAAY,WAAA,EAAa;AAClC,MAAA,OAAA,CAAQ,EAAA,CAAG,YAAA,EAAc,MAAM,IAAA,CAAK,OAAO,CAAA;AAC3C,MAAA,OAAA,CAAQ,EAAA,CAAG,UAAU,MAAM;AACzB,QAAA,IAAA,CAAK,OAAM,CAAE,OAAA,CAAQ,MAAM,OAAA,CAAQ,IAAA,CAAK,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAC,CAAA;AACD,MAAA,OAAA,CAAQ,EAAA,CAAG,WAAW,MAAM;AAC1B,QAAA,IAAA,CAAK,OAAM,CAAE,OAAA,CAAQ,MAAM,OAAA,CAAQ,IAAA,CAAK,CAAC,CAAC,CAAA;AAAA,MAC5C,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,IAAA,CAAK,IAAI,uBAAA,EAAyB,EAAE,UAAA,EAAY,MAAA,CAAO,YAAY,CAAA;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CACE,IAAA,EACA,QAAA,EACA,OAAA,EACA,KAAA,EACM;AACN,IAAA,MAAM,MAAA,GAAqB;AAAA,MACzB,IAAA;AAAA,MACA,QAAA;AAAA,MACA,OAAA;AAAA,MACA,GAAI,KAAA,IAAS,EAAE,KAAA,EAAM;AAAA,MACrB,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,KACpC;AAEA,IAAA,IAAA,CAAK,MAAA,CAAO,KAAK,MAAM,CAAA;AACvB,IAAA,IAAA,CAAK,GAAA,CAAI,gBAAA,EAAkB,EAAE,GAAG,QAAQ,CAAA;AAGxC,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,MAAA,IAAU,IAAA,CAAK,OAAO,SAAA,EAAW;AAC/C,MAAA,IAAA,CAAK,OAAM,CAAE,KAAA,CAAM,KAAK,WAAA,CAAY,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,IAChD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG;AAE9B,IAAA,MAAM,OAAA,GAAU,CAAC,GAAG,IAAA,CAAK,MAAM,CAAA;AAC/B,IAAA,IAAA,CAAK,SAAS,EAAC;AAEf,IAAA,MAAM,KAAA,GAAwB;AAAA,MAC5B,UAAA,EAAY,KAAK,MAAA,CAAO,UAAA;AAAA,MACxB,aAAA,EAAe,KAAK,MAAA,CAAO,aAAA;AAAA,MAC3B,OAAA;AAAA,MACA,IAAA,EAAM;AAAA,QACJ,UAAA,EAAY,WAAA;AAAA,QACZ,WAAA,EAAa,OAAO,OAAA,KAAY,WAAA,GAAc,QAAQ,OAAA,GAAU,SAAA;AAAA,QAChE,QAAA,EAAU,OAAO,OAAA,KAAY,WAAA,GAAc,QAAQ,QAAA,GAAW;AAAA;AAChE,KACF;AAEA,IAAA,IAAA,CAAK,IAAI,kBAAA,EAAoB,EAAE,KAAA,EAAO,OAAA,CAAQ,QAAQ,CAAA;AAEtD,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,IAAA,CAAK,OAAO,QAAA,EAAU;AAAA,QACjD,MAAA,EAAQ,MAAA;AAAA,QACR,OAAA,EAAS;AAAA,UACP,cAAA,EAAgB,kBAAA;AAAA,UAChB,eAAA,EAAiB,CAAA,OAAA,EAAU,IAAA,CAAK,MAAA,CAAO,MAAM,CAAA,CAAA;AAAA,UAC7C,qBAAA,EAAuB;AAAA,SACzB;AAAA,QACA,IAAA,EAAM,IAAA,CAAK,SAAA,CAAU,KAAK;AAAA,OAC3B,CAAA;AAED,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,MAAM,IAAI,MAAM,CAAA,wBAAA,EAA2B,QAAA,CAAS,MAAM,CAAA,CAAA,EAAI,QAAA,CAAS,UAAU,CAAA,CAAE,CAAA;AAAA,MACrF;AAEA,MAAA,IAAA,CAAK,IAAI,8BAAA,EAAgC,EAAE,KAAA,EAAO,OAAA,CAAQ,QAAQ,CAAA;AAAA,IACpE,SAAS,KAAA,EAAO;AAEd,MAAA,IAAA,CAAK,MAAA,CAAO,OAAA,CAAQ,GAAG,OAAO,CAAA;AAC9B,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAiB;AACf,IAAA,IAAI,KAAK,UAAA,EAAY;AACnB,MAAA,aAAA,CAAc,KAAK,UAAU,CAAA;AAC7B,MAAA,IAAA,CAAK,UAAA,GAAa,IAAA;AAAA,IACpB;AACA,IAAA,IAAA,CAAK,OAAM,CAAE,KAAA,CAAM,KAAK,WAAA,CAAY,IAAA,CAAK,IAAI,CAAC,CAAA;AAC9C,IAAA,IAAA,CAAK,IAAI,oBAAoB,CAAA;AAAA,EAC/B;AAAA,EAEU,GAAA,CAAI,SAAiB,IAAA,EAAsC;AACnE,IAAA,IAAI,IAAA,CAAK,OAAO,KAAA,EAAO;AACrB,MAAA,OAAA,CAAQ,KAAA,CAAM,KAAK,SAAA,CAAU;AAAA,QAC3B,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,QAClC,KAAA,EAAO,OAAA;AAAA,QACP,OAAA,EAAS,yBAAA;AAAA,QACT,OAAA;AAAA,QACA,GAAG;AAAA,OACJ,CAAC,CAAA;AAAA,IACJ;AAAA,EACF;AAAA,EAEQ,YAAY,KAAA,EAAsB;AACxC,IAAA,IAAI,IAAA,CAAK,OAAO,KAAA,EAAO;AACrB,MAAA,OAAA,CAAQ,KAAA,CAAM,mCAAmC,KAAK,CAAA;AAAA,IACxD;AAAA,EACF;AACF;AAOA,IAAMA,YAAAA,GAAc,kBAAA;AAMb,IAAM,gBAAN,MAAoB;AAAA,EACjB,UAAA;AAAA,EACA,aAAA;AAAA,EACA,SAAuB,EAAC;AAAA,EAEhC,WAAA,CAAY,YAAoB,aAAA,EAAwB;AACtD,IAAA,IAAA,CAAK,UAAA,GAAa,UAAA;AAClB,IAAA,IAAA,CAAK,gBAAgB,aAAA,IAAiB,OAAA;AACtC,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAGA,YAAW,CAAA,0CAAA,EAA6C,UAAU,CAAA,CAAE,CAAA;AAAA,EACrF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CACE,IAAA,EACA,QAAA,EACA,OAAA,EACA,KAAA,EACM;AACN,IAAA,MAAM,MAAA,GAAqB;AAAA,MACzB,IAAA;AAAA,MACA,QAAA;AAAA,MACA,OAAA;AAAA,MACA,GAAI,KAAA,IAAS,EAAE,KAAA,EAAM;AAAA,MACrB,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,KACpC;AAEA,IAAA,IAAA,CAAK,MAAA,CAAO,KAAK,MAAM,CAAA;AAGvB,IAAA,UAAA,CAAW,UAAU,OAAA,EAAS;AAAA,MAC5B,IAAA;AAAA,MACA,QAAA,EAAU,GAAG,QAAQ,CAAA,EAAA,CAAA;AAAA,MACrB,OAAA;AAAA,MACA,GAAI,KAAA,IAAS,EAAE,KAAA;AAAM,KACtB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG;AAE9B,IAAA,MAAM,KAAA,GAAQ,KAAK,MAAA,CAAO,MAAA;AAG1B,IAAA,UAAA,CAAW,UAAU,OAAA,EAAS;AAAA,MAC5B,OAAA,EAAS,cAAc,KAAK,CAAA,yBAAA,CAAA;AAAA,MAC5B,OAAA,EAAS,IAAA,CAAK,MAAA,CAAO,KAAA,CAAM,GAAG,CAAC,CAAA;AAAA,MAC/B,GAAI,QAAQ,CAAA,IAAK,EAAE,MAAM,CAAA,OAAA,EAAU,KAAA,GAAQ,CAAC,CAAA,KAAA,CAAA;AAAQ,KACrD,CAAA;AAED,IAAA,IAAA,CAAK,SAAS,EAAC;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAiB;AACf,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAGA,YAAW,CAAA,mBAAA,CAAqB,CAAA;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAA0B;AACxB,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,MAAM,CAAA;AAAA,EACxB;AACF;;;AChRO,SAAS,kBAAkB,IAAA,EAAuB;AACvD,EAAA,OAAO,YAA0C;AAC/C,IAAA,MAAM,SAAkC,EAAC;AACzC,IAAA,IAAI,UAAA,GAAa,IAAA;AAEjB,IAAA,IAAI,KAAK,MAAA,EAAQ;AACf,MAAA,KAAA,MAAW,CAAC,MAAM,KAAK,CAAA,IAAK,OAAO,OAAA,CAAQ,IAAA,CAAK,MAAM,CAAA,EAAG;AACvD,QAAA,IAAI;AACF,UAAA,MAAA,CAAO,IAAI,CAAA,GAAI,MAAM,KAAA,EAAM;AAC3B,UAAA,IAAI,CAAC,MAAA,CAAO,IAAI,CAAA,EAAG,UAAA,GAAa,KAAA;AAAA,QAClC,CAAA,CAAA,MAAQ;AACN,UAAA,MAAA,CAAO,IAAI,CAAA,GAAI,KAAA;AACf,UAAA,UAAA,GAAa,KAAA;AAAA,QACf;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,MAAA,EAAQ,aAAa,SAAA,GAAY,UAAA;AAAA,MACjC,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,GAAI,IAAA,CAAK,WAAA,IAAe,EAAE,WAAA,EAAa,KAAK,WAAA,EAAY;AAAA,MACxD,GAAI,IAAA,CAAK,MAAA,IAAU,EAAE,MAAA,EAAQ,IAAA,CAAK,QAAO,EAAE;AAAA,MAC3C,SAAA,EAAA,iBAAW,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MAClC,GAAI,OAAO,IAAA,CAAK,MAAM,EAAE,MAAA,GAAS,CAAA,IAAK,EAAE,MAAA;AAAO,KACjD;AAAA,EACF,CAAA;AACF;AA4BO,SAAS,QAAA,CACd,SACA,OAAA,EACqC;AACrC,EAAA,MAAM;AAAA,IACJ,IAAA;AAAA,IACA,OAAA,GAAU,GAAA;AAAA,IACV,WAAW,eAAA,GAAkB;AAAA,GAC/B,GAAI,OAAA;AAEJ,EAAA,MAAM,UAAA,GAAa,OAAA,CAAQ,MAAA,IAAU,YAAA,CAAa,IAAI,CAAA;AAEtD,EAAA,OAAO,OAAO,KAAA,KAAoC;AAChD,IAAA,MAAM,SAAS,cAAA,EAAe;AAC9B,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,GAAA,GAAM,UAAA,CAAW,KAAA,CAAM,EAAE,QAAQ,CAAA;AAEvC,IAAA,MAAM,GAAA,GAAmB,EAAE,MAAA,EAAQ,IAAA,EAAM,WAAW,GAAA,EAAI;AAExD,IAAA,GAAA,CAAI,IAAA,CAAK,gBAAgB,EAAE,IAAA,EAAM,MAAM,KAAA,EAAO,aAAA,CAAc,KAAK,CAAA,EAAG,CAAA;AAEpE,IAAA,IAAI;AAEF,MAAA,MAAM,cAAA,GAAiB,IAAI,OAAA,CAAe,CAAC,GAAG,MAAA,KAAW;AACvD,QAAA,UAAA,CAAW,MAAM;AACf,UAAA,MAAA,CAAO,IAAI,YAAA,CAAa,IAAA,EAAM,OAAO,CAAC,CAAA;AAAA,QACxC,GAAG,OAAO,CAAA;AAAA,MACZ,CAAC,CAAA;AAGD,MAAA,MAAM,MAAA,GAAS,MAAM,OAAA,CAAQ,IAAA,CAAK;AAAA,QAChC,OAAA,CAAQ,OAAA,CAAQ,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAC,CAAA;AAAA,QACnC;AAAA,OACD,CAAA;AAED,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC9B,MAAA,GAAA,CAAI,KAAK,gBAAA,EAAkB,EAAE,IAAA,EAAM,IAAA,EAAM,UAAU,CAAA;AAGnD,MAAA,IAAI,eAAA,EAAiB;AACnB,QAAA,MAAM,MAAM,YAAA,EAAa;AACzB,QAAA,GAAA,EAAK,aAAA,CAAc,IAAA,EAAM,QAAA,EAAU,IAAI,CAAA;AAAA,MACzC;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC9B,MAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAE1E,MAAA,GAAA,CAAI,MAAM,aAAA,EAAe;AAAA,QACvB,IAAA,EAAM,IAAA;AAAA,QACN,QAAA;AAAA,QACA,KAAA,EAAO,YAAA;AAAA,QACP,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,KAAA,GAAQ;AAAA,OAC/C,CAAA;AAGD,MAAA,IAAI,eAAA,EAAiB;AACnB,QAAA,MAAM,MAAM,YAAA,EAAa;AACzB,QAAA,GAAA,EAAK,aAAA,CAAc,IAAA,EAAM,QAAA,EAAU,KAAA,EAAO,YAAY,CAAA;AAAA,MACxD;AAGA,MAAA,IAAI,iBAAiB,QAAA,EAAU;AAC7B,QAAA,MAAM,KAAA;AAAA,MACR;AAEA,MAAA,MAAM,IAAI,kBAAA;AAAA,QACR,IAAA;AAAA,QACA,YAAA;AAAA,QACA,KAAA,YAAiB,QAAQ,KAAA,GAAQ;AAAA,OACnC;AAAA,IACF;AAAA,EACF,CAAA;AACF;AAKA,SAAS,cAAA,GAAyB;AAChC,EAAA,OAAO,GAAG,IAAA,CAAK,GAAA,EAAI,CAAE,QAAA,CAAS,EAAE,CAAC,CAAA,CAAA,EAAI,IAAA,CAAK,MAAA,GAAS,QAAA,CAAS,EAAE,EAAE,KAAA,CAAM,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAC7E;AAKA,SAAS,cAAc,KAAA,EAAyB;AAC9C,EAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,MAAM,OAAO,KAAA;AAExD,EAAA,MAAM,gBAAgB,CAAC,UAAA,EAAY,SAAS,QAAA,EAAU,KAAA,EAAO,QAAQ,YAAY,CAAA;AACjF,EAAA,MAAM,YAAqC,EAAC;AAE5C,EAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,KAAgC,CAAA,EAAG;AAC3E,IAAA,IAAI,aAAA,CAAc,KAAK,CAAA,CAAA,KAAK,GAAA,CAAI,aAAY,CAAE,QAAA,CAAS,CAAC,CAAC,CAAA,EAAG;AAC1D,MAAA,SAAA,CAAU,GAAG,CAAA,GAAI,YAAA;AAAA,IACnB,CAAA,MAAO;AACL,MAAA,SAAA,CAAU,GAAG,CAAA,GAAI,KAAA;AAAA,IACnB;AAAA,EACF;AAEA,EAAA,OAAO,SAAA;AACT;;;ACzGA,IAAI,aAAA,GAAsC,IAAA;AAenC,SAAS,YAAY,MAAA,EAA8B;AAExD,EAAA,IAAI,YAAW,EAAG;AAChB,IAAA,aAAA,GAAgB;AAAA,MACd,MAAA,EAAQ,UAAA;AAAA,MACR,MAAA,EAAQ,8BAAA;AAAA,MACR,QAAA,EAAU,IAAA;AAAA,MACV,UAAA,EAAY;AAAA,KACd;AACA,IAAA;AAAA,EACF;AAGA,EAAA,IAAI,CAAC,QAAQ,MAAA,EAAQ;AACnB,IAAA,MAAM,IAAI,kBAAA,CAAmB,SAAA,EAAW,wGAAwG,CAAA;AAAA,EAClJ;AAEA,EAAA,aAAA,GAAgB;AAAA,IACd,MAAA,EAAQ,8BAAA;AAAA,IACR,QAAA,EAAU,KAAA;AAAA,IACV,GAAG;AAAA,GACL;AACF;AAKO,SAAS,gBAAA,GAAyC;AACvD,EAAA,OAAO,aAAA;AACT;AAmBA,eAAe,aAAa,MAAA,EAAoD;AAE9E,EAAA,IAAI,YAAW,EAAG;AAChB,IAAA,UAAA,CAAW,OAAA,CAAQ,MAAA,CAAO,MAAA,EAAQ,mBAAmB,CAAA;AACrD,IAAA,OAAO,mBAAA;AAAA,EACT;AAEA,EAAA,MAAM,MAAA,GAAS,aAAA;AACf,EAAA,IAAI,CAAC,MAAA,EAAQ;AACX,IAAA,MAAM,IAAI,kBAAA,CAAmB,SAAA,EAAW,oDAAoD,CAAA;AAAA,EAC9F;AAGA,EAAA,IAAI,OAAO,QAAA,EAAU;AACnB,IAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,OAAA,EAAS,IAAA,EAAM,MAAM,MAAA,EAAO;AAAA,EACtD;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,WAAW,MAAM,KAAA,CAAM,CAAA,EAAG,MAAA,CAAO,MAAM,CAAA,2BAAA,CAAA,EAA+B;AAAA,MAC1E,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS;AAAA,QACP,cAAA,EAAgB,kBAAA;AAAA,QAChB,eAAA,EAAiB,CAAA,OAAA,EAAU,MAAA,CAAO,MAAM,CAAA;AAAA,OAC1C;AAAA,MACA,IAAA,EAAM,KAAK,SAAA,CAAU;AAAA,QACnB,QAAQ,MAAA,CAAO,MAAA;AAAA,QACf,aAAa,MAAA,CAAO,WAAA;AAAA,QACpB,MAAM,MAAA,CAAO;AAAA,OACd;AAAA,KACF,CAAA;AAED,IAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAEhB,MAAA,MAAM,SAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AACtC,MAAA,OAAA,CAAQ,KAAA,CAAM,iCAAA,EAAmC,QAAA,CAAS,MAAA,EAAQ,SAAS,CAAA;AAC3E,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,MAAA,EAAQ,6BAAA;AAAA,QACR,WAAW,MAAA,CAAO;AAAA,OACpB;AAAA,IACF;AAEA,IAAA,OAAO,MAAM,SAAS,IAAA,EAAK;AAAA,EAC7B,SAAS,KAAA,EAAO;AAEd,IAAA,OAAA,CAAQ,KAAA,CAAM,kCAAkC,KAAK,CAAA;AACrD,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,MAAA,EAAQ,iCAAA;AAAA,MACR,WAAW,MAAA,CAAO;AAAA,KACpB;AAAA,EACF;AACF;AAEA,eAAe,cAAc,MAAA,EAA+C;AAE1E,EAAA,IAAI,YAAW,EAAG;AAChB,IAAA,UAAA,CAAW,OAAO,MAAA,CAAO,MAAA,EAAQ,MAAA,CAAO,OAAA,EAAS,OAAO,QAAQ,CAAA;AAChE,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,MAAM,MAAA,GAAS,aAAA;AACf,EAAA,IAAI,CAAC,QAAQ,OAAO,KAAA;AAGpB,EAAA,IAAI,MAAA,CAAO,UAAU,OAAO,IAAA;AAE5B,EAAA,IAAI;AACF,IAAA,MAAM,WAAW,MAAM,KAAA,CAAM,CAAA,EAAG,MAAA,CAAO,MAAM,CAAA,4BAAA,CAAA,EAAgC;AAAA,MAC3E,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS;AAAA,QACP,cAAA,EAAgB,kBAAA;AAAA,QAChB,eAAA,EAAiB,CAAA,OAAA,EAAU,MAAA,CAAO,MAAM,CAAA;AAAA,OAC1C;AAAA,MACA,IAAA,EAAM,KAAK,SAAA,CAAU;AAAA,QACnB,QAAQ,MAAA,CAAO,MAAA;AAAA,QACf,SAAS,MAAA,CAAO,OAAA;AAAA,QAChB,MAAM,MAAA,CAAO,QAAA;AAAA,QACb,QAAQ,MAAA,CAAO;AAAA,OAChB;AAAA,KACF,CAAA;AAED,IAAA,OAAO,QAAA,CAAS,EAAA;AAAA,EAClB,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,qCAAqC,KAAK,CAAA;AACxD,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAMA,SAAS,oBAAoB,GAAA,EAAmD;AAC9E,EAAA,OAAO,SAAA,IAAa,GAAA,IAAO,OAAO,GAAA,CAAI,OAAA,KAAY,QAAA;AACpD;AAEA,SAAS,0BAA0B,GAAA,EAAyD;AAC1F,EAAA,OAAO,MAAA,IAAU,GAAA,IAAO,OAAO,GAAA,CAAI,IAAA,KAAS,QAAA;AAC9C;AAEA,SAAS,oBAAoB,GAAA,EAAmD;AAC9E,EAAA,OAAO,SAAA,IAAa,GAAA,IAAO,OAAO,GAAA,CAAI,OAAA,KAAY,QAAA;AACpD;AAoCO,SAAS,cAAA,CACd,WAAA,EACA,OAAA,GAAiC,EAAC,EAClC;AACA,EAAA,OAAO,CACL,OAAA,KAC0C;AAE1C,IAAA,MAAM,EAAE,QAAA,GAAW,SAAA,EAAW,SAAA,EAAU,GAAI,OAAA;AAE5C,IAAA,OAAO,OAAO,KAAA,KAAoC;AAEhD,MAAA,MAAM,MAAA,GAAS,SAAA,GAAY,KAAK,CAAA,IAAK,KAAA,CAAM,MAAA;AAE3C,MAAA,IAAI,CAAC,MAAA,EAAQ;AACX,QAAA,MAAM,IAAI,qBAAqB,QAAA,EAAU;AAAA,UACvC,YAAY,aAAA,EAAe;AAAA,SAC5B,CAAA;AAAA,MACH;AAGA,MAAA,MAAM,MAAA,GAAS,MAAM,YAAA,CAAa;AAAA,QAChC,MAAA;AAAA,QACA,WAAA;AAAA,QACA;AAAA,OACD,CAAA;AAED,MAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AAEnB,QAAA,IAAI,mBAAA,CAAoB,WAAW,CAAA,EAAG;AACpC,UAAA,MAAM,IAAI,wBAAA;AAAA,YACR,WAAA,CAAY,OAAA;AAAA,YACZ,OAAO,OAAA,IAAW,CAAA;AAAA,YAClB,EAAE,WAAA,EAAa,MAAA,CAAO,SAAA;AAAU,WAClC;AAAA,QACF;AAEA,QAAA,IAAI,yBAAA,CAA0B,WAAW,CAAA,EAAG;AAC1C,UAAA,MAAM,IAAI,yBAAA;AAAA,YACR,WAAA,CAAY,IAAA;AAAA,YACZ,MAAA,CAAO,IAAA;AAAA,YACP,EAAE,UAAA,EAAY,MAAA,CAAO,SAAA;AAAU,WACjC;AAAA,QACF;AAGA,QAAA,MAAM,IAAI,qBAAqB,QAAA,EAAU;AAAA,UACvC,YAAY,MAAA,CAAO,SAAA;AAAA,UACnB,GAAI,mBAAA,CAAoB,WAAW,KAAK,EAAE,OAAA,EAAS,YAAY,OAAA;AAAQ,SACxE,CAAA;AAAA,MACH;AAGA,MAAA,MAAM,MAAA,GAAS,MAAM,OAAA,CAAQ,KAAK,CAAA;AAGlC,MAAA,IAAI,mBAAA,CAAoB,WAAW,CAAA,EAAG;AACpC,QAAA,MAAM,aAAA,CAAc;AAAA,UAClB,MAAA;AAAA,UACA,SAAS,WAAA,CAAY,OAAA;AAAA,UACrB;AAAA,SACD,CAAA;AAAA,MACH;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,CAAA;AAAA,EACF,CAAA;AACF;AAqBO,SAAS,eAA4D,MAAA,EAKpC;AACtC,EAAA,OAAO,cAAA,CAAgC,OAAO,OAAA,EAAS;AAAA,IACrD,UAAU,MAAA,CAAO,IAAA;AAAA,IACjB,WAAW,MAAA,CAAO;AAAA,GACnB,CAAA,CAAE,MAAA,CAAO,OAAO,CAAA;AACnB;AAcA,eAAsB,aAAA,CACpB,MAAA,EACA,WAAA,EACA,QAAA,GAAmB,OAAA,EACK;AACxB,EAAA,OAAO,YAAA,CAAa,EAAE,MAAA,EAAQ,WAAA,EAAa,UAAU,CAAA;AACvD;AAKA,eAAsB,qBAAqB,MAAA,EAIjC;AAER,EAAA,IAAI,YAAW,EAAG;AAChB,IAAA,OAAO,iBAAA;AAAA,EACT;AAEA,EAAA,MAAM,MAAA,GAAS,aAAA;AACf,EAAA,IAAI,CAAC,QAAQ,OAAO,IAAA;AAEpB,EAAA,IAAI,OAAO,QAAA,EAAU;AACnB,IAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,IAAA,EAAM,MAAA,EAAQ,QAAQ,IAAA,EAAK;AAAA,EACrD;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,CAAA,EAAG,OAAO,MAAM,CAAA,6BAAA,EAAgC,MAAM,CAAA,CAAA,EAAI;AAAA,MACrF,OAAA,EAAS;AAAA,QACP,eAAA,EAAiB,CAAA,OAAA,EAAU,MAAA,CAAO,MAAM,CAAA;AAAA;AAC1C,KACD,CAAA;AAED,IAAA,IAAI,CAAC,QAAA,CAAS,EAAA,EAAI,OAAO,IAAA;AACzB,IAAA,OAAO,MAAM,SAAS,IAAA,EAAK;AAAA,EAC7B,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,IAAA;AAAA,EACT;AACF","file":"index.mjs","sourcesContent":["/**\n * @openconductor/mcp-sdk - Global Configuration\n * \n * Single source of truth for SDK mode (demo vs production)\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface OpenConductorConfig {\n  /** OpenConductor API key (optional in demo mode) */\n  apiKey?: string\n  /** Force demo mode even if API key is provided */\n  demoMode?: boolean\n  /** Server name for telemetry */\n  serverName?: string\n  /** Server version */\n  serverVersion?: string\n  /** Suppress demo mode banner */\n  quiet?: boolean\n}\n\nexport interface ResolvedConfig {\n  apiKey: string | null\n  demoMode: boolean\n  serverName: string\n  serverVersion: string\n  initialized: boolean\n}\n\n// ============================================================================\n// State\n// ============================================================================\n\nlet globalConfig: ResolvedConfig = {\n  apiKey: null,\n  demoMode: false,\n  serverName: 'mcp-server',\n  serverVersion: '0.0.0',\n  initialized: false,\n}\n\n// ============================================================================\n// Demo Mode Banner\n// ============================================================================\n\nconst DEMO_BANNER = `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                                                 ‚îÇ\n‚îÇ   üéÆ  DEMO MODE ACTIVE                                          ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îÇ   The SDK is running without an API key.                        ‚îÇ\n‚îÇ   ‚Ä¢ Payment: Mock billing (always allowed, 9999 credits)        ‚îÇ\n‚îÇ   ‚Ä¢ Telemetry: Logging to console only                          ‚îÇ\n‚îÇ   ‚Ä¢ All features work - no data sent to OpenConductor           ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îÇ   To enable production mode:                                    ‚îÇ\n‚îÇ   1. Get a free API key at https://openconductor.ai             ‚îÇ\n‚îÇ   2. Set OPENCONDUCTOR_API_KEY environment variable             ‚îÇ\n‚îÇ      or pass apiKey to initOpenConductor()                      ‚îÇ\n‚îÇ                                                                 ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n`\n\nconst PRODUCTION_BANNER = `\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ   ‚úÖ  OpenConductor SDK initialized (production mode)           ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n`\n\n// ============================================================================\n// Initialization\n// ============================================================================\n\n/**\n * Initialize the OpenConductor SDK\n * \n * Call this once at startup. If no API key is provided (via config or \n * OPENCONDUCTOR_API_KEY env var), the SDK automatically enables Demo Mode.\n * \n * @example Production mode\n * ```typescript\n * initOpenConductor({\n *   apiKey: process.env.OPENCONDUCTOR_API_KEY,\n *   serverName: 'my-server',\n *   serverVersion: '1.0.0'\n * })\n * ```\n * \n * @example Demo mode (explicit)\n * ```typescript\n * initOpenConductor({ demoMode: true })\n * ```\n * \n * @example Demo mode (auto-detected)\n * ```typescript\n * // No API key? Demo mode activates automatically\n * initOpenConductor({ serverName: 'my-server' })\n * ```\n */\nexport function initOpenConductor(config: OpenConductorConfig = {}): ResolvedConfig {\n  // Resolve API key from config or environment\n  const apiKey = config.apiKey ?? process.env.OPENCONDUCTOR_API_KEY ?? null\n  \n  // Determine demo mode\n  // Demo if: explicitly set OR no API key provided\n  const demoMode = config.demoMode === true || !apiKey\n  \n  globalConfig = {\n    apiKey: demoMode ? null : apiKey,\n    demoMode,\n    serverName: config.serverName ?? process.env.OPENCONDUCTOR_SERVER_NAME ?? 'mcp-server',\n    serverVersion: config.serverVersion ?? process.env.npm_package_version ?? '0.0.0',\n    initialized: true,\n  }\n  \n  // Print banner unless quiet\n  if (!config.quiet) {\n    if (demoMode) {\n      console.log(DEMO_BANNER)\n    } else {\n      console.log(PRODUCTION_BANNER)\n    }\n  }\n  \n  return globalConfig\n}\n\n/**\n * Get current SDK configuration\n * Auto-initializes in demo mode if not already initialized\n */\nexport function getConfig(): ResolvedConfig {\n  if (!globalConfig.initialized) {\n    // Auto-init in demo mode for zero-config experience\n    return initOpenConductor({ quiet: true })\n  }\n  return globalConfig\n}\n\n/**\n * Check if SDK is in demo mode\n */\nexport function isDemoMode(): boolean {\n  return getConfig().demoMode\n}\n\n/**\n * Check if SDK is initialized\n */\nexport function isInitialized(): boolean {\n  return globalConfig.initialized\n}\n\n/**\n * Reset configuration (mainly for testing)\n */\nexport function resetConfig(): void {\n  globalConfig = {\n    apiKey: null,\n    demoMode: false,\n    serverName: 'mcp-server',\n    serverVersion: '0.0.0',\n    initialized: false,\n  }\n}\n","/**\n * @openconductor/mcp-sdk - Demo Mode Mock Data\n * \n * Realistic sample data for zero-config demo experience\n */\n\nimport type { BillingStatus, UsageAnalytics, CreditPackInfo, CreditPack } from '../payment'\nimport type { ToolMetric } from '../telemetry'\n\n// ============================================================================\n// Mock Billing Data\n// ============================================================================\n\nexport const MOCK_BILLING_STATUS: BillingStatus = {\n  allowed: true,\n  credits: 9999,\n  tier: 'demo',\n  reason: undefined,\n  actionUrl: 'https://openconductor.ai/pricing',\n}\n\nexport const MOCK_USER_BILLING = {\n  credits: 9999,\n  tier: 'demo',\n  active: true,\n}\n\nexport const MOCK_CREDIT_PACKS: Record<CreditPack, CreditPackInfo> = {\n  starter: {\n    name: 'Starter Pack',\n    credits: 100,\n    price: 9.99,\n    perCredit: 0.0999,\n    savings: 0,\n    bestFor: 'Testing and small projects',\n  },\n  pro: {\n    name: 'Pro Pack',\n    credits: 500,\n    price: 39.99,\n    perCredit: 0.0799,\n    savings: 20,\n    bestFor: 'Growing projects',\n    popular: true,\n  },\n  business: {\n    name: 'Business Pack',\n    credits: 2000,\n    price: 119.99,\n    perCredit: 0.0599,\n    savings: 40,\n    bestFor: 'Production workloads',\n  },\n}\n\n// ============================================================================\n// Mock Analytics Data\n// ============================================================================\n\nfunction generateMockTimeline(days: number): Array<{ date: string; used: number; purchased: number }> {\n  const timeline: Array<{ date: string; used: number; purchased: number }> = []\n  const now = new Date()\n  \n  for (let i = days - 1; i >= 0; i--) {\n    const date = new Date(now)\n    date.setDate(date.getDate() - i)\n    timeline.push({\n      date: date.toISOString().split('T')[0],\n      used: Math.floor(Math.random() * 50) + 10,\n      purchased: i % 7 === 0 ? 500 : 0, // Weekly purchases\n    })\n  }\n  \n  return timeline\n}\n\nfunction generateMockTransactions(count: number): UsageAnalytics['recentTransactions'] {\n  const tools = ['analyze-data', 'generate-report', 'search-docs', 'summarize', 'translate']\n  const transactions: UsageAnalytics['recentTransactions'] = []\n  const now = new Date()\n  \n  for (let i = 0; i < count; i++) {\n    const isDebit = Math.random() > 0.2\n    const date = new Date(now)\n    date.setHours(date.getHours() - i * 2)\n    \n    transactions.push({\n      id: `txn_demo_${i}`,\n      amount: isDebit ? -(Math.floor(Math.random() * 20) + 1) : 500,\n      type: isDebit ? 'usage' : 'purchase',\n      tool: isDebit ? tools[Math.floor(Math.random() * tools.length)] : null,\n      createdAt: date.toISOString(),\n    })\n  }\n  \n  return transactions\n}\n\nexport function getMockAnalytics(period: '24h' | '7d' | '30d' | 'all'): UsageAnalytics {\n  const days = period === '24h' ? 1 : period === '7d' ? 7 : period === '30d' ? 30 : 90\n  const timeline = generateMockTimeline(days)\n  const totalUsed = timeline.reduce((sum, d) => sum + d.used, 0)\n  const totalPurchased = timeline.reduce((sum, d) => sum + d.purchased, 0)\n  \n  return {\n    period,\n    balance: 9999,\n    summary: {\n      totalUsed,\n      totalPurchased,\n      netChange: totalPurchased - totalUsed,\n      burnRate: totalUsed / days,\n      daysRemaining: Math.floor(9999 / (totalUsed / days)),\n      toolCount: 5,\n      transactionCount: days * 3,\n    },\n    topTools: [\n      { tool: 'analyze-data', calls: 156, credits: 780 },\n      { tool: 'generate-report', calls: 89, credits: 445 },\n      { tool: 'search-docs', calls: 234, credits: 234 },\n      { tool: 'summarize', calls: 67, credits: 335 },\n      { tool: 'translate', calls: 45, credits: 90 },\n    ],\n    usageTimeline: timeline,\n    recentTransactions: generateMockTransactions(10),\n  }\n}\n\n// ============================================================================\n// Mock Telemetry Data\n// ============================================================================\n\nexport function createMockMetric(tool: string, duration: number, success: boolean): ToolMetric {\n  return {\n    tool,\n    duration,\n    success,\n    error: success ? undefined : 'Mock error for demo',\n    timestamp: new Date().toISOString(),\n  }\n}\n\n// ============================================================================\n// Demo Console Logger\n// ============================================================================\n\nconst DEMO_PREFIX = '[üéÆ DEMO]'\n\nexport const demoLogger = {\n  telemetry: (action: string, data: Record<string, unknown>) => {\n    console.log(`${DEMO_PREFIX} Telemetry ${action}:`, JSON.stringify(data, null, 2))\n  },\n  \n  payment: (action: string, data: Record<string, unknown>) => {\n    console.log(`${DEMO_PREFIX} Payment ${action}:`, JSON.stringify(data, null, 2))\n  },\n  \n  billing: (userId: string, result: BillingStatus) => {\n    console.log(`${DEMO_PREFIX} Billing check for ${userId}: ALLOWED (demo mode)`)\n  },\n  \n  deduct: (userId: string, credits: number, tool: string) => {\n    console.log(`${DEMO_PREFIX} Would deduct ${credits} credits from ${userId} for ${tool} (skipped in demo)`)\n  },\n}\n","/**\n * JSON-RPC 2.0 Standard Error Codes\n * https://www.jsonrpc.org/specification#error_object\n */\nexport const ErrorCodes = {\n  // JSON-RPC 2.0 Standard Errors\n  PARSE_ERROR: -32700,\n  INVALID_REQUEST: -32600,\n  METHOD_NOT_FOUND: -32601,\n  INVALID_PARAMS: -32602,\n  INTERNAL_ERROR: -32603,\n\n  // MCP-Specific Errors (-32000 to -32099 reserved for implementation)\n  TOOL_NOT_FOUND: -32001,\n  TOOL_EXECUTION_ERROR: -32002,\n  RESOURCE_NOT_FOUND: -32003,\n  AUTHENTICATION_ERROR: -32004,\n  AUTHORIZATION_ERROR: -32005,\n  RATE_LIMIT_ERROR: -32006,\n  TIMEOUT_ERROR: -32007,\n  VALIDATION_ERROR: -32008,\n  DEPENDENCY_ERROR: -32009,\n  CONFIGURATION_ERROR: -32010,\n  PAYMENT_REQUIRED: -32011,\n  INSUFFICIENT_CREDITS: -32012,\n  SUBSCRIPTION_REQUIRED: -32013,\n} as const\n\nexport type ErrorCode = (typeof ErrorCodes)[keyof typeof ErrorCodes]\n","import { ErrorCodes, type ErrorCode } from './codes'\n\nexport { ErrorCodes, type ErrorCode } from './codes'\n\n/**\n * Base error class for MCP servers\n * Formats errors according to JSON-RPC 2.0 specification\n */\nexport class MCPError extends Error {\n  public readonly code: ErrorCode\n  public readonly data?: Record<string, unknown>\n\n  constructor(\n    code: ErrorCode,\n    message: string,\n    data?: Record<string, unknown>\n  ) {\n    super(message)\n    this.name = 'MCPError'\n    this.code = code\n    this.data = data\n\n    // Maintains proper stack trace in V8 environments\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor)\n    }\n  }\n\n  /**\n   * Returns JSON-RPC 2.0 formatted error object\n   */\n  toJSON() {\n    return {\n      code: this.code,\n      message: this.message,\n      ...(this.data && { data: this.data }),\n    }\n  }\n\n  /**\n   * Create error response for JSON-RPC\n   */\n  toResponse(id: string | number | null = null) {\n    return {\n      jsonrpc: '2.0' as const,\n      id,\n      error: this.toJSON(),\n    }\n  }\n}\n\n/**\n * Thrown when tool input validation fails\n */\nexport class ValidationError extends MCPError {\n  constructor(field: string, reason: string, value?: unknown) {\n    super(ErrorCodes.INVALID_PARAMS, `Validation failed for '${field}': ${reason}`, {\n      field,\n      reason,\n      ...(value !== undefined && { value }),\n    })\n    this.name = 'ValidationError'\n  }\n}\n\n/**\n * Thrown when a requested tool doesn't exist\n */\nexport class ToolNotFoundError extends MCPError {\n  constructor(toolName: string) {\n    super(ErrorCodes.TOOL_NOT_FOUND, `Tool '${toolName}' not found`, {\n      tool: toolName,\n    })\n    this.name = 'ToolNotFoundError'\n  }\n}\n\n/**\n * Thrown when tool execution fails\n */\nexport class ToolExecutionError extends MCPError {\n  constructor(toolName: string, reason: string, cause?: Error) {\n    super(ErrorCodes.TOOL_EXECUTION_ERROR, `Tool '${toolName}' failed: ${reason}`, {\n      tool: toolName,\n      reason,\n      ...(cause && { cause: cause.message }),\n    })\n    this.name = 'ToolExecutionError'\n  }\n}\n\n/**\n * Thrown when a requested resource doesn't exist\n */\nexport class ResourceNotFoundError extends MCPError {\n  constructor(resourceUri: string) {\n    super(ErrorCodes.RESOURCE_NOT_FOUND, `Resource '${resourceUri}' not found`, {\n      uri: resourceUri,\n    })\n    this.name = 'ResourceNotFoundError'\n  }\n}\n\n/**\n * Thrown when authentication fails\n */\nexport class AuthenticationError extends MCPError {\n  constructor(reason: string = 'Authentication required') {\n    super(ErrorCodes.AUTHENTICATION_ERROR, reason)\n    this.name = 'AuthenticationError'\n  }\n}\n\n/**\n * Thrown when authorization fails (authenticated but not permitted)\n */\nexport class AuthorizationError extends MCPError {\n  constructor(action: string, resource?: string) {\n    const msg = resource\n      ? `Not authorized to ${action} on '${resource}'`\n      : `Not authorized to ${action}`\n    super(ErrorCodes.AUTHORIZATION_ERROR, msg, {\n      action,\n      ...(resource && { resource }),\n    })\n    this.name = 'AuthorizationError'\n  }\n}\n\n/**\n * Thrown when rate limits are exceeded\n */\nexport class RateLimitError extends MCPError {\n  constructor(retryAfterMs?: number) {\n    super(ErrorCodes.RATE_LIMIT_ERROR, 'Rate limit exceeded', {\n      ...(retryAfterMs && { retryAfterMs }),\n    })\n    this.name = 'RateLimitError'\n  }\n}\n\n/**\n * Thrown when an operation times out\n */\nexport class TimeoutError extends MCPError {\n  constructor(operation: string, timeoutMs: number) {\n    super(ErrorCodes.TIMEOUT_ERROR, `Operation '${operation}' timed out after ${timeoutMs}ms`, {\n      operation,\n      timeoutMs,\n    })\n    this.name = 'TimeoutError'\n  }\n}\n\n/**\n * Thrown when a required dependency is unavailable\n */\nexport class DependencyError extends MCPError {\n  constructor(dependency: string, reason: string) {\n    super(ErrorCodes.DEPENDENCY_ERROR, `Dependency '${dependency}' unavailable: ${reason}`, {\n      dependency,\n      reason,\n    })\n    this.name = 'DependencyError'\n  }\n}\n\n/**\n * Thrown when server configuration is invalid\n */\nexport class ConfigurationError extends MCPError {\n  constructor(setting: string, reason: string) {\n    super(ErrorCodes.CONFIGURATION_ERROR, `Invalid configuration '${setting}': ${reason}`, {\n      setting,\n      reason,\n    })\n    this.name = 'ConfigurationError'\n  }\n}\n\n/**\n * Thrown when payment is required to access a tool\n */\nexport class PaymentRequiredError extends MCPError {\n  constructor(toolName: string, options?: { upgradeUrl?: string; priceId?: string }) {\n    super(ErrorCodes.PAYMENT_REQUIRED, `Payment required to use '${toolName}'`, {\n      tool: toolName,\n      ...(options?.upgradeUrl && { upgradeUrl: options.upgradeUrl }),\n      ...(options?.priceId && { priceId: options.priceId }),\n    })\n    this.name = 'PaymentRequiredError'\n  }\n}\n\n/**\n * Thrown when user doesn't have enough credits\n */\nexport class InsufficientCreditsError extends MCPError {\n  constructor(required: number, available: number, options?: { purchaseUrl?: string }) {\n    super(ErrorCodes.INSUFFICIENT_CREDITS, `Insufficient credits: need ${required}, have ${available}`, {\n      required,\n      available,\n      ...(options?.purchaseUrl && { purchaseUrl: options.purchaseUrl }),\n    })\n    this.name = 'InsufficientCreditsError'\n  }\n}\n\n/**\n * Thrown when a subscription tier is required\n */\nexport class SubscriptionRequiredError extends MCPError {\n  constructor(requiredTier: string, currentTier?: string, options?: { upgradeUrl?: string }) {\n    const msg = currentTier \n      ? `Subscription '${requiredTier}' required (current: '${currentTier}')`\n      : `Subscription '${requiredTier}' required`\n    super(ErrorCodes.SUBSCRIPTION_REQUIRED, msg, {\n      requiredTier,\n      ...(currentTier && { currentTier }),\n      ...(options?.upgradeUrl && { upgradeUrl: options.upgradeUrl }),\n    })\n    this.name = 'SubscriptionRequiredError'\n  }\n}\n","import { z, ZodError, type ZodSchema, type ZodTypeDef, type SafeParseReturnType } from 'zod'\nimport { ValidationError } from '../errors'\n\n// Re-export zod for convenience\nexport { z, ZodError, type ZodSchema }\nexport type { ZodTypeDef }\n\n/**\n * Options for input validation\n */\nexport interface ValidateOptions {\n  /** Strip unknown keys from objects (default: true) */\n  stripUnknown?: boolean\n  /** Custom error formatter */\n  formatError?: (error: ZodError) => string\n}\n\n/**\n * Validates input against a Zod schema\n * Throws ValidationError on failure with detailed field info\n */\nexport function validate<T>(\n  schema: ZodSchema<T>,\n  input: unknown,\n  options: ValidateOptions = {}\n): T {\n  const { stripUnknown = true } = options\n\n  const result = (\n    stripUnknown\n      ? schema.safeParse(input)\n      : schema instanceof z.ZodObject\n        ? schema.strict().safeParse(input)\n        : schema.safeParse(input)\n  ) as SafeParseReturnType<unknown, T>\n\n  if (!result.success) {\n    const firstError = result.error.errors[0]\n    const field = firstError.path.join('.') || 'input'\n    const reason = firstError.message\n    throw new ValidationError(field, reason, firstError.path.length > 0 \n      ? getNestedValue(input, firstError.path) \n      : input\n    )\n  }\n\n  return result.data\n}\n\n/**\n * Creates a validated tool handler\n * Wraps your handler function with automatic input validation\n */\nexport function validateInput<TInput, TOutput>(\n  schema: ZodSchema<TInput>,\n  handler: (input: TInput) => TOutput | Promise<TOutput>,\n  options: ValidateOptions = {}\n): (input: unknown) => Promise<TOutput> {\n  return async (input: unknown) => {\n    const validated = validate(schema, input, options)\n    return handler(validated)\n  }\n}\n\n\n/**\n * Helper to extract nested value from object by path\n */\nfunction getNestedValue(obj: unknown, path: (string | number)[]): unknown {\n  let current = obj\n  for (const key of path) {\n    if (current === null || current === undefined) return undefined\n    current = (current as Record<string | number, unknown>)[key]\n  }\n  return current\n}\n\n/**\n * Common schema patterns for MCP tools\n */\nexport const schemas = {\n  /** Non-empty string */\n  nonEmptyString: z.string().min(1, 'Cannot be empty'),\n  \n  /** Positive integer */\n  positiveInt: z.number().int().positive(),\n  \n  /** Pagination limit (1-100, default 10) */\n  limit: z.number().int().min(1).max(100).default(10),\n  \n  /** Pagination offset (>= 0, default 0) */\n  offset: z.number().int().min(0).default(0),\n  \n  /** URL string */\n  url: z.string().url(),\n  \n  /** Email string */\n  email: z.string().email(),\n  \n  /** UUID string */\n  uuid: z.string().uuid(),\n  \n  /** ISO date string */\n  isoDate: z.string().datetime(),\n  \n  /** Boolean with string coercion ('true'/'false' -> boolean) */\n  booleanish: z.union([\n    z.boolean(),\n    z.enum(['true', 'false']).transform(v => v === 'true'),\n  ]),\n}\n\n/**\n * Type helper to infer schema type\n */\nexport type Infer<T extends ZodSchema> = z.infer<T>\n","export type LogLevel = 'debug' | 'info' | 'warn' | 'error'\n\nexport interface LogEntry {\n  timestamp?: string\n  level: LogLevel\n  service: string\n  message: string\n  [key: string]: unknown\n}\n\nexport interface LoggerOptions {\n  /** Minimum log level to output (default: 'info') */\n  level?: LogLevel\n  /** Custom output function (default: console methods) */\n  output?: (entry: LogEntry) => void\n  /** Include timestamps (default: true) */\n  timestamps?: boolean\n  /** Pretty print JSON (default: false, use true for local dev) */\n  pretty?: boolean\n}\n\nconst LEVEL_PRIORITY: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n}\n\n/**\n * Creates a structured logger for MCP servers\n */\nexport function createLogger(service: string, options: LoggerOptions = {}) {\n  const {\n    level: minLevel = 'info',\n    timestamps = true,\n    pretty = false,\n  } = options\n\n  const shouldLog = (level: LogLevel): boolean => {\n    return LEVEL_PRIORITY[level] >= LEVEL_PRIORITY[minLevel]\n  }\n\n  const formatEntry = (entry: LogEntry): string => {\n    return pretty ? JSON.stringify(entry, null, 2) : JSON.stringify(entry)\n  }\n\n  const log = (level: LogLevel, message: string, data?: Record<string, unknown>) => {\n    if (!shouldLog(level)) return\n\n    const entry: LogEntry = {\n      ...(timestamps && { timestamp: new Date().toISOString() }),\n      level,\n      service,\n      message,\n      ...data,\n    }\n\n    if (options.output) {\n      options.output(entry)\n    } else {\n      const formatted = formatEntry(entry)\n      switch (level) {\n        case 'debug':\n          console.debug(formatted)\n          break\n        case 'info':\n          console.info(formatted)\n          break\n        case 'warn':\n          console.warn(formatted)\n          break\n        case 'error':\n          console.error(formatted)\n          break\n      }\n    }\n\n    return entry\n  }\n\n  return {\n    debug: (message: string, data?: Record<string, unknown>) => log('debug', message, data),\n    info: (message: string, data?: Record<string, unknown>) => log('info', message, data),\n    warn: (message: string, data?: Record<string, unknown>) => log('warn', message, data),\n    error: (message: string, data?: Record<string, unknown>) => log('error', message, data),\n    \n    /**\n     * Create a child logger with additional context\n     */\n    child: (context: Record<string, unknown>) => {\n      return createLogger(service, {\n        ...options,\n        output: (entry) => {\n          const merged = { ...entry, ...context }\n          if (options.output) {\n            options.output(merged)\n          } else {\n            const formatted = pretty ? JSON.stringify(merged, null, 2) : JSON.stringify(merged)\n            console[entry.level](formatted)\n          }\n        },\n      })\n    },\n  }\n}\n\nexport type Logger = ReturnType<typeof createLogger>\n","import { getConfig, isDemoMode } from '../config'\nimport { demoLogger } from '../demo'\n\nexport interface TelemetryConfig {\n  /** Your OpenConductor API key */\n  apiKey: string\n  /** Server name for identification */\n  serverName: string\n  /** Server version */\n  serverVersion?: string\n  /** Custom endpoint (default: OpenConductor production) */\n  endpoint?: string\n  /** Batch size before flushing (default: 10) */\n  batchSize?: number\n  /** Flush interval in ms (default: 30000) */\n  flushInterval?: number\n  /** Enable debug logging (default: false) */\n  debug?: boolean\n}\n\nexport interface ToolMetric {\n  tool: string\n  duration: number\n  success: boolean\n  error?: string\n  timestamp: string\n}\n\nexport interface TelemetryBatch {\n  serverName: string\n  serverVersion?: string\n  metrics: ToolMetric[]\n  meta: {\n    sdkVersion: string\n    nodeVersion: string\n    platform: string\n  }\n}\n\nconst SDK_VERSION = '1.0.0'\nconst DEFAULT_ENDPOINT = 'https://api.openconductor.ai/functions/v1/telemetry'\n\nlet globalTelemetry: Telemetry | DemoTelemetry | null = null\n\n/**\n * Initialize telemetry for your MCP server\n * \n * In demo mode, this is optional - telemetry will log to console instead of API.\n * Call this once at startup with your OpenConductor API key for production.\n */\nexport function initTelemetry(config?: TelemetryConfig): Telemetry | DemoTelemetry {\n  const sdkConfig = getConfig()\n  \n  // In demo mode, create a demo telemetry instance\n  if (isDemoMode()) {\n    globalTelemetry = new DemoTelemetry(\n      config?.serverName ?? sdkConfig.serverName,\n      config?.serverVersion ?? sdkConfig.serverVersion\n    )\n    return globalTelemetry\n  }\n  \n  // Production mode - require config\n  if (!config?.apiKey) {\n    throw new Error('Telemetry requires apiKey in production mode. Set OPENCONDUCTOR_API_KEY or pass apiKey to initTelemetry().')\n  }\n  \n  globalTelemetry = new Telemetry(config)\n  return globalTelemetry\n}\n\n/**\n * Get the global telemetry instance (if initialized)\n */\nexport function getTelemetry(): Telemetry | DemoTelemetry | null {\n  return globalTelemetry\n}\n\n\nexport class Telemetry {\n  private config: Required<Omit<TelemetryConfig, 'serverVersion'>> & Pick<TelemetryConfig, 'serverVersion'>\n  protected buffer: ToolMetric[] = []\n  private flushTimer: ReturnType<typeof setInterval> | null = null\n\n  constructor(config: TelemetryConfig) {\n    this.config = {\n      apiKey: config.apiKey,\n      serverName: config.serverName,\n      serverVersion: config.serverVersion,\n      endpoint: config.endpoint ?? DEFAULT_ENDPOINT,\n      batchSize: config.batchSize ?? 10,\n      flushInterval: config.flushInterval ?? 30000,\n      debug: config.debug ?? false,\n    }\n\n    // Start periodic flush\n    this.flushTimer = setInterval(() => {\n      this.flush().catch(this.handleError.bind(this))\n    }, this.config.flushInterval)\n\n    // Flush on process exit\n    if (typeof process !== 'undefined') {\n      process.on('beforeExit', () => this.flush())\n      process.on('SIGINT', () => {\n        this.flush().finally(() => process.exit(0))\n      })\n      process.on('SIGTERM', () => {\n        this.flush().finally(() => process.exit(0))\n      })\n    }\n\n    this.log('Telemetry initialized', { serverName: config.serverName })\n  }\n\n  /**\n   * Track a tool invocation\n   */\n  trackToolCall(\n    tool: string,\n    duration: number,\n    success: boolean,\n    error?: string\n  ): void {\n    const metric: ToolMetric = {\n      tool,\n      duration,\n      success,\n      ...(error && { error }),\n      timestamp: new Date().toISOString(),\n    }\n\n    this.buffer.push(metric)\n    this.log('Metric tracked', { ...metric })\n\n    // Auto-flush if buffer is full\n    if (this.buffer.length >= this.config.batchSize) {\n      this.flush().catch(this.handleError.bind(this))\n    }\n  }\n\n  /**\n   * Flush buffered metrics to OpenConductor\n   */\n  async flush(): Promise<void> {\n    if (this.buffer.length === 0) return\n\n    const metrics = [...this.buffer]\n    this.buffer = []\n\n    const batch: TelemetryBatch = {\n      serverName: this.config.serverName,\n      serverVersion: this.config.serverVersion,\n      metrics,\n      meta: {\n        sdkVersion: SDK_VERSION,\n        nodeVersion: typeof process !== 'undefined' ? process.version : 'unknown',\n        platform: typeof process !== 'undefined' ? process.platform : 'unknown',\n      },\n    }\n\n    this.log('Flushing metrics', { count: metrics.length })\n\n    try {\n      const response = await fetch(this.config.endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.config.apiKey}`,\n          'X-OpenConductor-SDK': SDK_VERSION,\n        },\n        body: JSON.stringify(batch),\n      })\n\n      if (!response.ok) {\n        throw new Error(`Telemetry flush failed: ${response.status} ${response.statusText}`)\n      }\n\n      this.log('Metrics flushed successfully', { count: metrics.length })\n    } catch (error) {\n      // Put metrics back in buffer on failure\n      this.buffer.unshift(...metrics)\n      throw error\n    }\n  }\n\n  /**\n   * Stop telemetry collection\n   */\n  shutdown(): void {\n    if (this.flushTimer) {\n      clearInterval(this.flushTimer)\n      this.flushTimer = null\n    }\n    this.flush().catch(this.handleError.bind(this))\n    this.log('Telemetry shutdown')\n  }\n\n  protected log(message: string, data?: Record<string, unknown>): void {\n    if (this.config.debug) {\n      console.debug(JSON.stringify({\n        timestamp: new Date().toISOString(),\n        level: 'debug',\n        service: 'openconductor-telemetry',\n        message,\n        ...data,\n      }))\n    }\n  }\n\n  private handleError(error: unknown): void {\n    if (this.config.debug) {\n      console.error('[OpenConductor Telemetry Error]', error)\n    }\n  }\n}\n\n\n// ============================================================================\n// Demo Telemetry\n// ============================================================================\n\nconst DEMO_PREFIX = '[üéÆ DEMO]'\n\n/**\n * Demo telemetry that logs to console instead of sending to API\n * Automatically used in demo mode\n */\nexport class DemoTelemetry {\n  private serverName: string\n  private serverVersion: string\n  private buffer: ToolMetric[] = []\n\n  constructor(serverName: string, serverVersion?: string) {\n    this.serverName = serverName\n    this.serverVersion = serverVersion ?? '0.0.0'\n    console.log(`${DEMO_PREFIX} Telemetry initialized (console mode) for ${serverName}`)\n  }\n\n  /**\n   * Track a tool invocation - logs to console in demo mode\n   */\n  trackToolCall(\n    tool: string,\n    duration: number,\n    success: boolean,\n    error?: string\n  ): void {\n    const metric: ToolMetric = {\n      tool,\n      duration,\n      success,\n      ...(error && { error }),\n      timestamp: new Date().toISOString(),\n    }\n\n    this.buffer.push(metric)\n\n    // Log to console in demo mode\n    demoLogger.telemetry('track', {\n      tool,\n      duration: `${duration}ms`,\n      success,\n      ...(error && { error }),\n    })\n  }\n\n  /**\n   * Flush - in demo mode, just logs a summary\n   */\n  async flush(): Promise<void> {\n    if (this.buffer.length === 0) return\n\n    const count = this.buffer.length\n\n    // Log summary instead of sending\n    demoLogger.telemetry('flush', {\n      message: `Would send ${count} metrics to OpenConductor`,\n      metrics: this.buffer.slice(0, 3),\n      ...(count > 3 && { more: `...and ${count - 3} more` }),\n    })\n\n    this.buffer = []\n  }\n\n  /**\n   * Shutdown - no-op in demo mode\n   */\n  shutdown(): void {\n    console.log(`${DEMO_PREFIX} Telemetry shutdown`)\n  }\n\n  /**\n   * Get buffered metrics (useful for testing/inspection)\n   */\n  getBuffer(): ToolMetric[] {\n    return [...this.buffer]\n  }\n}\n","import { MCPError, ToolExecutionError, TimeoutError } from '../errors'\nimport { createLogger, type Logger } from '../logger'\nimport { getTelemetry } from '../telemetry'\n\nexport interface HealthCheckInfo {\n  name: string\n  version: string\n  description?: string\n  uptime?: () => number\n  checks?: Record<string, () => Promise<boolean> | boolean>\n}\n\nexport interface HealthCheckResponse {\n  status: 'healthy' | 'degraded' | 'unhealthy'\n  name: string\n  version: string\n  description?: string\n  uptime?: number\n  timestamp: string\n  checks?: Record<string, boolean>\n}\n\n/**\n * Creates a standard health check response for MCP servers\n */\nexport function createHealthCheck(info: HealthCheckInfo) {\n  return async (): Promise<HealthCheckResponse> => {\n    const checks: Record<string, boolean> = {}\n    let allHealthy = true\n\n    if (info.checks) {\n      for (const [name, check] of Object.entries(info.checks)) {\n        try {\n          checks[name] = await check()\n          if (!checks[name]) allHealthy = false\n        } catch {\n          checks[name] = false\n          allHealthy = false\n        }\n      }\n    }\n\n    return {\n      status: allHealthy ? 'healthy' : 'degraded',\n      name: info.name,\n      version: info.version,\n      ...(info.description && { description: info.description }),\n      ...(info.uptime && { uptime: info.uptime() }),\n      timestamp: new Date().toISOString(),\n      ...(Object.keys(checks).length > 0 && { checks }),\n    }\n  }\n}\n\n\nexport interface WrapToolOptions {\n  /** Tool name for logging and telemetry */\n  name: string\n  /** Timeout in milliseconds (default: 30000) */\n  timeout?: number\n  /** Custom logger instance */\n  logger?: Logger\n  /** Enable telemetry reporting (default: true if telemetry initialized) */\n  telemetry?: boolean\n}\n\nexport interface ToolContext {\n  /** Unique ID for this tool call */\n  callId: string\n  /** Tool name */\n  name: string\n  /** Start time of execution */\n  startTime: number\n  /** Logger scoped to this call */\n  log: Logger\n}\n\n/**\n * Wraps a tool handler with automatic error handling, logging, timeouts, and telemetry\n */\nexport function wrapTool<TInput, TOutput>(\n  handler: (input: TInput, ctx: ToolContext) => TOutput | Promise<TOutput>,\n  options: WrapToolOptions\n): (input: TInput) => Promise<TOutput> {\n  const {\n    name,\n    timeout = 30000,\n    telemetry: enableTelemetry = true,\n  } = options\n\n  const baseLogger = options.logger ?? createLogger(name)\n\n  return async (input: TInput): Promise<TOutput> => {\n    const callId = generateCallId()\n    const startTime = Date.now()\n    const log = baseLogger.child({ callId })\n\n    const ctx: ToolContext = { callId, name, startTime, log }\n\n    log.info('Tool invoked', { tool: name, input: sanitizeInput(input) })\n\n    try {\n      // Create timeout promise\n      const timeoutPromise = new Promise<never>((_, reject) => {\n        setTimeout(() => {\n          reject(new TimeoutError(name, timeout))\n        }, timeout)\n      })\n\n      // Race handler against timeout\n      const result = await Promise.race([\n        Promise.resolve(handler(input, ctx)),\n        timeoutPromise,\n      ])\n\n      const duration = Date.now() - startTime\n      log.info('Tool completed', { tool: name, duration })\n\n      // Report success to telemetry\n      if (enableTelemetry) {\n        const tel = getTelemetry()\n        tel?.trackToolCall(name, duration, true)\n      }\n\n      return result\n    } catch (error) {\n      const duration = Date.now() - startTime\n      const errorMessage = error instanceof Error ? error.message : String(error)\n\n      log.error('Tool failed', { \n        tool: name, \n        duration, \n        error: errorMessage,\n        stack: error instanceof Error ? error.stack : undefined,\n      })\n\n      // Report failure to telemetry\n      if (enableTelemetry) {\n        const tel = getTelemetry()\n        tel?.trackToolCall(name, duration, false, errorMessage)\n      }\n\n      // Re-throw MCPErrors as-is, wrap others\n      if (error instanceof MCPError) {\n        throw error\n      }\n\n      throw new ToolExecutionError(\n        name,\n        errorMessage,\n        error instanceof Error ? error : undefined\n      )\n    }\n  }\n}\n\n/**\n * Generates a unique call ID\n */\nfunction generateCallId(): string {\n  return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`\n}\n\n/**\n * Sanitizes input for logging (removes sensitive fields)\n */\nfunction sanitizeInput(input: unknown): unknown {\n  if (typeof input !== 'object' || input === null) return input\n\n  const sensitiveKeys = ['password', 'token', 'secret', 'key', 'auth', 'credential']\n  const sanitized: Record<string, unknown> = {}\n\n  for (const [key, value] of Object.entries(input as Record<string, unknown>)) {\n    if (sensitiveKeys.some(k => key.toLowerCase().includes(k))) {\n      sanitized[key] = '[REDACTED]'\n    } else {\n      sanitized[key] = value\n    }\n  }\n\n  return sanitized\n}\n","import {\n  PaymentRequiredError,\n  InsufficientCreditsError,\n  SubscriptionRequiredError,\n  ConfigurationError,\n} from '../errors'\nimport { getConfig, isDemoMode } from '../config'\nimport {\n  MOCK_BILLING_STATUS,\n  MOCK_USER_BILLING,\n  MOCK_CREDIT_PACKS,\n  getMockAnalytics,\n  demoLogger,\n} from '../demo'\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface PaymentConfig {\n  /** OpenConductor API key for billing */\n  apiKey: string\n  /** Base URL for billing API (default: https://api.openconductor.ai) */\n  apiUrl?: string\n  /** Default upgrade URL to show users */\n  upgradeUrl?: string\n  /** Enable test mode (skips actual billing) */\n  testMode?: boolean\n}\n\nexport interface CreditRequirement {\n  /** Number of credits to deduct per call */\n  credits: number\n}\n\nexport interface SubscriptionRequirement {\n  /** Required subscription tier (e.g., 'pro', 'enterprise') */\n  tier: string\n  /** Alternative tiers that also grant access */\n  allowedTiers?: string[]\n}\n\nexport interface StripeRequirement {\n  /** Stripe Price ID for per-call billing */\n  priceId: string\n}\n\nexport type PaymentRequirement = \n  | CreditRequirement \n  | SubscriptionRequirement \n  | StripeRequirement\n\nexport interface UserContext {\n  /** User ID for billing lookup */\n  userId: string\n  /** Optional API key override */\n  apiKey?: string\n}\n\nexport interface BillingStatus {\n  /** Whether the user can proceed */\n  allowed: boolean\n  /** Current credit balance (if applicable) */\n  credits?: number\n  /** Current subscription tier (if applicable) */\n  tier?: string\n  /** Reason for denial (if not allowed) */\n  reason?: string\n  /** URL for upgrade/purchase */\n  actionUrl?: string\n}\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nlet paymentConfig: PaymentConfig | null = null\n\n/**\n * Initialize payment/billing configuration\n * \n * In demo mode, this is optional - mock billing will be used automatically.\n * \n * @example\n * ```typescript\n * initPayment({\n *   apiKey: process.env.OPENCONDUCTOR_API_KEY!,\n *   upgradeUrl: 'https://myapp.com/upgrade'\n * })\n * ```\n */\nexport function initPayment(config?: PaymentConfig): void {\n  // In demo mode, auto-configure with mocks\n  if (isDemoMode()) {\n    paymentConfig = {\n      apiKey: 'demo_key',\n      apiUrl: 'https://api.openconductor.ai',\n      testMode: true,\n      upgradeUrl: 'https://openconductor.ai/pricing',\n    }\n    return\n  }\n  \n  // Production mode - require config\n  if (!config?.apiKey) {\n    throw new ConfigurationError('payment', 'Payment requires apiKey in production mode. Set OPENCONDUCTOR_API_KEY or pass apiKey to initPayment().')\n  }\n  \n  paymentConfig = {\n    apiUrl: 'https://api.openconductor.ai',\n    testMode: false,\n    ...config,\n  }\n}\n\n/**\n * Get current payment configuration\n */\nexport function getPaymentConfig(): PaymentConfig | null {\n  return paymentConfig\n}\n\n// ============================================================================\n// Billing Client\n// ============================================================================\n\ninterface CheckBillingParams {\n  userId: string\n  requirement: PaymentRequirement\n  toolName: string\n}\n\ninterface DeductCreditsParams {\n  userId: string\n  credits: number\n  toolName: string\n  callId?: string\n}\n\nasync function checkBilling(params: CheckBillingParams): Promise<BillingStatus> {\n  // Demo mode - return mock data\n  if (isDemoMode()) {\n    demoLogger.billing(params.userId, MOCK_BILLING_STATUS)\n    return MOCK_BILLING_STATUS\n  }\n\n  const config = paymentConfig\n  if (!config) {\n    throw new ConfigurationError('payment', 'Payment not initialized. Call initPayment() first.')\n  }\n\n  // Test mode - always allow\n  if (config.testMode) {\n    return { allowed: true, credits: 9999, tier: 'test' }\n  }\n\n  try {\n    const response = await fetch(`${config.apiUrl}/functions/v1/billing-check`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${config.apiKey}`,\n      },\n      body: JSON.stringify({\n        userId: params.userId,\n        requirement: params.requirement,\n        tool: params.toolName,\n      }),\n    })\n\n    if (!response.ok) {\n      // Non-2xx response - treat as billing check failed\n      const errorBody = await response.text()\n      console.error('[payment] Billing check failed:', response.status, errorBody)\n      return {\n        allowed: false,\n        reason: 'Billing service unavailable',\n        actionUrl: config.upgradeUrl,\n      }\n    }\n\n    return await response.json() as BillingStatus\n  } catch (error) {\n    // Network error - fail open or closed based on config\n    console.error('[payment] Billing check error:', error)\n    return {\n      allowed: false,\n      reason: 'Unable to verify billing status',\n      actionUrl: config.upgradeUrl,\n    }\n  }\n}\n\nasync function deductCredits(params: DeductCreditsParams): Promise<boolean> {\n  // Demo mode - log but don't deduct\n  if (isDemoMode()) {\n    demoLogger.deduct(params.userId, params.credits, params.toolName)\n    return true\n  }\n\n  const config = paymentConfig\n  if (!config) return false\n\n  // Test mode - don't actually deduct\n  if (config.testMode) return true\n\n  try {\n    const response = await fetch(`${config.apiUrl}/functions/v1/billing-deduct`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${config.apiKey}`,\n      },\n      body: JSON.stringify({\n        userId: params.userId,\n        credits: params.credits,\n        tool: params.toolName,\n        callId: params.callId,\n      }),\n    })\n\n    return response.ok\n  } catch (error) {\n    console.error('[payment] Credit deduction error:', error)\n    return false\n  }\n}\n\n// ============================================================================\n// Type Guards\n// ============================================================================\n\nfunction isCreditRequirement(req: PaymentRequirement): req is CreditRequirement {\n  return 'credits' in req && typeof req.credits === 'number'\n}\n\nfunction isSubscriptionRequirement(req: PaymentRequirement): req is SubscriptionRequirement {\n  return 'tier' in req && typeof req.tier === 'string'\n}\n\nfunction isStripeRequirement(req: PaymentRequirement): req is StripeRequirement {\n  return 'priceId' in req && typeof req.priceId === 'string'\n}\n\n// ============================================================================\n// Main Middleware\n// ============================================================================\n\nexport interface RequirePaymentOptions {\n  /** Tool name for billing records */\n  toolName?: string\n  /** Function to extract user ID from input */\n  getUserId?: (input: unknown) => string | undefined\n  /** Custom error handler */\n  onPaymentError?: (error: Error) => void\n}\n\n/**\n * One-line payment middleware for MCP tools\n * \n * @example Credits-based billing\n * ```typescript\n * const paidTool = requirePayment({ credits: 10 })(myHandler)\n * ```\n * \n * @example Subscription tier requirement\n * ```typescript\n * const premiumTool = requirePayment({ tier: 'pro' })(myHandler)\n * ```\n * \n * @example With wrapTool\n * ```typescript\n * const safePaidTool = wrapTool(\n *   requirePayment({ credits: 5 })(myHandler),\n *   { name: 'premium-analysis' }\n * )\n * ```\n */\nexport function requirePayment<TInput extends { userId?: string }, TOutput>(\n  requirement: PaymentRequirement,\n  options: RequirePaymentOptions = {}\n) {\n  return (\n    handler: (input: TInput) => TOutput | Promise<TOutput>\n  ): ((input: TInput) => Promise<TOutput>) => {\n    \n    const { toolName = 'unknown', getUserId } = options\n\n    return async (input: TInput): Promise<TOutput> => {\n      // Extract user ID\n      const userId = getUserId?.(input) ?? input.userId\n      \n      if (!userId) {\n        throw new PaymentRequiredError(toolName, {\n          upgradeUrl: paymentConfig?.upgradeUrl,\n        })\n      }\n\n      // Check billing status\n      const status = await checkBilling({\n        userId,\n        requirement,\n        toolName,\n      })\n\n      if (!status.allowed) {\n        // Throw appropriate error based on requirement type\n        if (isCreditRequirement(requirement)) {\n          throw new InsufficientCreditsError(\n            requirement.credits,\n            status.credits ?? 0,\n            { purchaseUrl: status.actionUrl }\n          )\n        }\n\n        if (isSubscriptionRequirement(requirement)) {\n          throw new SubscriptionRequiredError(\n            requirement.tier,\n            status.tier,\n            { upgradeUrl: status.actionUrl }\n          )\n        }\n\n        // Generic payment required\n        throw new PaymentRequiredError(toolName, {\n          upgradeUrl: status.actionUrl,\n          ...(isStripeRequirement(requirement) && { priceId: requirement.priceId }),\n        })\n      }\n\n      // Execute the handler\n      const result = await handler(input)\n\n      // Deduct credits after successful execution (if credit-based)\n      if (isCreditRequirement(requirement)) {\n        await deductCredits({\n          userId,\n          credits: requirement.credits,\n          toolName,\n        })\n      }\n\n      return result\n    }\n  }\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Create a paid tool with built-in payment verification\n * \n * @example\n * ```typescript\n * const analyzeData = createPaidTool({\n *   name: 'analyze-data',\n *   payment: { credits: 10 },\n *   handler: async (input) => {\n *     // Your tool logic\n *     return result\n *   }\n * })\n * ```\n */\nexport function createPaidTool<TInput extends { userId?: string }, TOutput>(config: {\n  name: string\n  payment: PaymentRequirement\n  handler: (input: TInput) => TOutput | Promise<TOutput>\n  getUserId?: (input: TInput) => string | undefined\n}): (input: TInput) => Promise<TOutput> {\n  return requirePayment<TInput, TOutput>(config.payment, {\n    toolName: config.name,\n    getUserId: config.getUserId as (input: unknown) => string | undefined,\n  })(config.handler)\n}\n\n/**\n * Check if a user can access a paid feature without executing it\n * Useful for UI gating\n * \n * @example\n * ```typescript\n * const canAccess = await canUserAccess('user_123', { credits: 10 }, 'premium-tool')\n * if (!canAccess.allowed) {\n *   showUpgradePrompt(canAccess.actionUrl)\n * }\n * ```\n */\nexport async function canUserAccess(\n  userId: string,\n  requirement: PaymentRequirement,\n  toolName: string = 'check'\n): Promise<BillingStatus> {\n  return checkBilling({ userId, requirement, toolName })\n}\n\n/**\n * Get user's current billing status\n */\nexport async function getUserBillingStatus(userId: string): Promise<{\n  credits: number\n  tier: string\n  active: boolean\n} | null> {\n  // Demo mode - return mock data\n  if (isDemoMode()) {\n    return MOCK_USER_BILLING\n  }\n\n  const config = paymentConfig\n  if (!config) return null\n\n  if (config.testMode) {\n    return { credits: 9999, tier: 'test', active: true }\n  }\n\n  try {\n    const response = await fetch(`${config.apiUrl}/functions/v1/billing-status/${userId}`, {\n      headers: {\n        'Authorization': `Bearer ${config.apiKey}`,\n      },\n    })\n\n    if (!response.ok) return null\n    return await response.json()\n  } catch {\n    return null\n  }\n}\n\n// ============================================================================\n// Checkout Helpers\n// ============================================================================\n\nexport type CreditPack = 'starter' | 'pro' | 'business'\n\nexport interface CreditPackInfo {\n  name: string\n  credits: number\n  price: number\n  perCredit: number\n  savings: number\n  bestFor: string\n  popular?: boolean\n}\n\nexport interface CheckoutSession {\n  sessionId: string\n  url: string\n  pack: CreditPack\n  credits: number\n  price: number\n  perCredit: number\n}\n\n/**\n * Get available credit packs and pricing\n * \n * @example\n * ```typescript\n * const packs = await getCreditPacks()\n * console.log(packs.pro) // { name: 'Pro Pack', credits: 500, price: 39.99, ... }\n * ```\n */\nexport async function getCreditPacks(): Promise<Record<CreditPack, CreditPackInfo> | null> {\n  // Demo mode - return mock packs\n  if (isDemoMode()) {\n    return MOCK_CREDIT_PACKS\n  }\n\n  const config = paymentConfig\n  if (!config) return null\n\n  try {\n    const response = await fetch(`${config.apiUrl}/functions/v1/credit-packs`)\n    if (!response.ok) return null\n    const data = await response.json()\n    return data.packs\n  } catch {\n    return null\n  }\n}\n\n/**\n * Create a Stripe checkout session for purchasing credits\n * Returns a URL to redirect the user to for payment\n * \n * @example\n * ```typescript\n * const checkout = await createCreditsCheckout('pro', {\n *   successUrl: 'https://myapp.com/success',\n *   cancelUrl: 'https://myapp.com/pricing',\n * })\n * \n * // Redirect user to checkout\n * window.location.href = checkout.url\n * ```\n */\nexport async function createCreditsCheckout(\n  pack: CreditPack,\n  options: {\n    successUrl?: string\n    cancelUrl?: string\n  } = {}\n): Promise<CheckoutSession | null> {\n  const config = paymentConfig\n  if (!config) {\n    console.error('[payment] Payment not initialized. Call initPayment() first.')\n    return null\n  }\n\n  try {\n    const response = await fetch(`${config.apiUrl}/functions/v1/stripe-checkout-credits`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${config.apiKey}`,\n      },\n      body: JSON.stringify({\n        pack,\n        successUrl: options.successUrl,\n        cancelUrl: options.cancelUrl,\n      }),\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      console.error('[payment] Checkout creation failed:', error)\n      return null\n    }\n\n    return await response.json() as CheckoutSession\n  } catch (error) {\n    console.error('[payment] Checkout error:', error)\n    return null\n  }\n}\n\n/**\n * Generate a direct checkout URL for embedding in upgrade prompts\n * \n * @example In an error handler:\n * ```typescript\n * catch (error) {\n *   if (error instanceof InsufficientCreditsError) {\n *     const checkoutUrl = await getCheckoutUrl('pro')\n *     return { error: `Insufficient credits. Buy more: ${checkoutUrl}` }\n *   }\n * }\n * ```\n */\nexport async function getCheckoutUrl(pack: CreditPack): Promise<string | null> {\n  const session = await createCreditsCheckout(pack)\n  return session?.url ?? null\n}\n\n// ============================================================================\n// Upgrade Prompts\n// ============================================================================\n\nexport interface UpgradePromptOptions {\n  /** Required credits for the blocked action */\n  required?: number\n  /** Currently available credits */\n  available?: number\n  /** Tool that was blocked */\n  toolName?: string\n  /** Include direct checkout links */\n  includeLinks?: boolean\n}\n\n/**\n * Generate a user-friendly upgrade prompt message\n * Use this in your error handlers to show helpful messages\n * \n * @example\n * ```typescript\n * catch (error) {\n *   if (error instanceof InsufficientCreditsError) {\n *     const prompt = await generateUpgradePrompt({\n *       required: error.data.required,\n *       available: error.data.available,\n *       toolName: 'analyze-data'\n *     })\n *     console.log(prompt.message)\n *     // \"You need 10 more credits to use analyze-data. \n *     //  Buy the Pro Pack (500 credits) for $39.99 ‚Üí https://...\"\n *   }\n * }\n * ```\n */\nexport async function generateUpgradePrompt(\n  options: UpgradePromptOptions = {}\n): Promise<{\n  message: string\n  shortMessage: string\n  recommendedPack: CreditPack\n  packs: Record<CreditPack, { credits: number; price: number; url: string | null }>\n}> {\n  const { required = 0, available = 0, toolName, includeLinks = true } = options\n  const needed = Math.max(0, required - available)\n  \n  // Determine recommended pack based on needed credits\n  let recommendedPack: CreditPack = 'starter'\n  if (needed > 100) recommendedPack = 'pro'\n  if (needed > 500) recommendedPack = 'business'\n  \n  // Get pack URLs if requested\n  const packUrls: Record<CreditPack, string | null> = {\n    starter: null,\n    pro: null,\n    business: null,\n  }\n  \n  if (includeLinks) {\n    const [starterUrl, proUrl, businessUrl] = await Promise.all([\n      getCheckoutUrl('starter'),\n      getCheckoutUrl('pro'),\n      getCheckoutUrl('business'),\n    ])\n    packUrls.starter = starterUrl\n    packUrls.pro = proUrl\n    packUrls.business = businessUrl\n  }\n  \n  // Build message\n  const toolPart = toolName ? ` to use ${toolName}` : ''\n  const shortMessage = `Insufficient credits: need ${required}, have ${available}`\n  \n  let message = `You need ${needed} more credits${toolPart}.\\n\\n`\n  message += `üí≥ Quick top-up options:\\n`\n  message += `  ‚Ä¢ Starter: 100 credits for $9.99${packUrls.starter ? ` ‚Üí ${packUrls.starter}` : ''}\\n`\n  message += `  ‚Ä¢ Pro: 500 credits for $39.99 (20% off)${packUrls.pro ? ` ‚Üí ${packUrls.pro}` : ''}\\n`\n  message += `  ‚Ä¢ Business: 2,000 credits for $119.99 (40% off)${packUrls.business ? ` ‚Üí ${packUrls.business}` : ''}\\n`\n  \n  if (recommendedPack !== 'starter') {\n    message += `\\n‚ú® Recommended: ${recommendedPack.charAt(0).toUpperCase() + recommendedPack.slice(1)} Pack`\n  }\n  \n  return {\n    message,\n    shortMessage,\n    recommendedPack,\n    packs: {\n      starter: { credits: 100, price: 9.99, url: packUrls.starter },\n      pro: { credits: 500, price: 39.99, url: packUrls.pro },\n      business: { credits: 2000, price: 119.99, url: packUrls.business },\n    },\n  }\n}\n\n/**\n * Get a simple checkout URL for the dashboard\n * Useful when you don't want to create a full Stripe session\n */\nexport function getDashboardCheckoutUrl(options: {\n  required?: number\n  available?: number\n  pack?: CreditPack\n} = {}): string {\n  const params = new URLSearchParams()\n  params.set('action', 'buy-credits')\n  if (options.required) params.set('required', String(options.required))\n  if (options.available) params.set('available', String(options.available))\n  if (options.pack) params.set('pack', options.pack)\n  return `https://dashboard.openconductor.ai?${params.toString()}`\n}\n\n/**\n * Create an error handler that automatically generates upgrade prompts\n * \n * @example\n * ```typescript\n * const handleError = createUpgradeErrorHandler({\n *   onInsufficientCredits: (prompt) => {\n *     return { error: prompt.shortMessage, upgradeUrl: prompt.packs.pro.url }\n *   }\n * })\n * \n * // In your tool:\n * try {\n *   return await paidHandler(input)\n * } catch (error) {\n *   return handleError(error)\n * }\n * ```\n */\nexport function createUpgradeErrorHandler(handlers: {\n  onInsufficientCredits?: (prompt: Awaited<ReturnType<typeof generateUpgradePrompt>>) => unknown\n  onSubscriptionRequired?: (error: SubscriptionRequiredError) => unknown\n  onPaymentRequired?: (error: PaymentRequiredError) => unknown\n  onOtherError?: (error: Error) => unknown\n}) {\n  return async (error: Error): Promise<unknown> => {\n    if (error instanceof InsufficientCreditsError && handlers.onInsufficientCredits) {\n      const prompt = await generateUpgradePrompt({\n        required: error.data?.required as number,\n        available: error.data?.available as number,\n      })\n      return handlers.onInsufficientCredits(prompt)\n    }\n    \n    if (error instanceof SubscriptionRequiredError && handlers.onSubscriptionRequired) {\n      return handlers.onSubscriptionRequired(error)\n    }\n    \n    if (error instanceof PaymentRequiredError && handlers.onPaymentRequired) {\n      return handlers.onPaymentRequired(error)\n    }\n    \n    if (handlers.onOtherError) {\n      return handlers.onOtherError(error)\n    }\n    \n    throw error\n  }\n}\n\n// ============================================================================\n// Usage Analytics\n// ============================================================================\n\nexport type AnalyticsPeriod = '24h' | '7d' | '30d' | 'all'\n\nexport interface UsageAnalytics {\n  period: AnalyticsPeriod\n  balance: number\n  summary: {\n    totalUsed: number\n    totalPurchased: number\n    netChange: number\n    burnRate: number\n    daysRemaining: number | null\n    toolCount: number\n    transactionCount: number\n  }\n  topTools: Array<{\n    tool: string\n    calls: number\n    credits: number\n  }>\n  usageTimeline: Array<{\n    date: string\n    used: number\n    purchased: number\n  }>\n  recentTransactions: Array<{\n    id: string\n    amount: number\n    type: string\n    tool: string | null\n    createdAt: string\n  }>\n}\n\n/**\n * Get usage analytics for a user\n * \n * @example\n * ```typescript\n * const analytics = await getUserAnalytics('user_123', '30d')\n * console.log(`Burn rate: ${analytics.summary.burnRate} credits/day`)\n * console.log(`Days remaining: ${analytics.summary.daysRemaining}`)\n * ```\n */\nexport async function getUserAnalytics(\n  userId: string,\n  period: AnalyticsPeriod = '30d'\n): Promise<UsageAnalytics | null> {\n  // Demo mode - return realistic mock data\n  if (isDemoMode()) {\n    return getMockAnalytics(period)\n  }\n\n  const config = paymentConfig\n  if (!config) {\n    console.error('[payment] Payment not initialized. Call initPayment() first.')\n    return null\n  }\n\n  if (config.testMode) {\n    // Return mock data in test mode\n    return {\n      period,\n      balance: 9999,\n      summary: {\n        totalUsed: 100,\n        totalPurchased: 500,\n        netChange: 400,\n        burnRate: 3.33,\n        daysRemaining: 3000,\n        toolCount: 5,\n        transactionCount: 30,\n      },\n      topTools: [\n        { tool: 'test-tool', calls: 10, credits: 50 },\n      ],\n      usageTimeline: [],\n      recentTransactions: [],\n    }\n  }\n\n  try {\n    const response = await fetch(\n      `${config.apiUrl}/functions/v1/usage-analytics/${userId}?period=${period}`,\n      {\n        headers: {\n          'Authorization': `Bearer ${config.apiKey}`,\n        },\n      }\n    )\n\n    if (!response.ok) return null\n    return await response.json() as UsageAnalytics\n  } catch (error) {\n    console.error('[payment] Analytics fetch error:', error)\n    return null\n  }\n}\n\n/**\n * Check if user's credits are running low based on burn rate\n * Returns recommended action if low\n * \n * @example\n * ```typescript\n * const warning = await checkLowBalance('user_123')\n * if (warning) {\n *   sendNotification(warning.message)\n * }\n * ```\n */\nexport async function checkLowBalance(\n  userId: string,\n  thresholdDays: number = 7\n): Promise<{\n  isLow: boolean\n  daysRemaining: number | null\n  balance: number\n  burnRate: number\n  message: string\n  recommendedPack: CreditPack\n} | null> {\n  const analytics = await getUserAnalytics(userId, '7d')\n  if (!analytics) return null\n\n  const { balance, summary } = analytics\n  const { burnRate, daysRemaining } = summary\n  \n  const isLow = daysRemaining !== null && daysRemaining <= thresholdDays\n  \n  // Recommend pack based on burn rate\n  let recommendedPack: CreditPack = 'starter'\n  const weeklyBurn = burnRate * 7\n  if (weeklyBurn > 100) recommendedPack = 'pro'\n  if (weeklyBurn > 400) recommendedPack = 'business'\n  \n  let message = ''\n  if (isLow) {\n    if (daysRemaining === 0) {\n      message = `‚ö†Ô∏è Credits depleted! Balance: ${balance}. Buy more to continue.`\n    } else if (daysRemaining <= 1) {\n      message = `‚ö†Ô∏è Running low! ~${daysRemaining} day of credits left at current usage.`\n    } else {\n      message = `üìä ~${daysRemaining} days of credits remaining at current burn rate (${burnRate.toFixed(1)}/day).`\n    }\n  }\n  \n  return {\n    isLow,\n    daysRemaining,\n    balance,\n    burnRate,\n    message,\n    recommendedPack,\n  }\n}\n"]}